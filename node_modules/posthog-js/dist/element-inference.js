function r(r,i,o){return void 0===i&&(i=document),void 0===o&&(o=null),function(r,i,o,t){void 0===t&&(t=null);return r=function(r){function n(){u&&(t.length>0&&/^[~+>]$/.test(t[t.length-1])&&t.push(" "),t.push(u))}var e,u,i,o,t=[],f=[0],l=0,a=/(?:[^\\]|(?:^|[^\\])(?:\\\\)+)$/,v=/^\s+$/,c=[/\s+|\/\*|["'>~+[(]/g,/\s+|\/\*|["'[\]()]/g,/\s+|\/\*|["'[\]()]/g,null,/\*\//g];for(r=r.trim();;){if(u="",(i=c[f[f.length-1]]).lastIndex=l,!(e=i.exec(r))){u=r.substr(l),n();break}if((o=l)<(l=i.lastIndex)-e[0].length&&(u=r.substring(o,l-e[0].length)),f[f.length-1]<3){if(n(),"["===e[0])f.push(1);else if("("===e[0])f.push(2);else if(/^["']$/.test(e[0]))f.push(3),c[3]=new RegExp(e[0],"g");else if("/*"===e[0])f.push(4);else if(/^[\])]$/.test(e[0])&&f.length>0)f.pop();else if(/^(?:\s+|[~+>])$/.test(e[0])&&(t.length>0&&!v.test(t[t.length-1])&&0===f[f.length-1]&&t.push(" "),1===f[f.length-1]&&5===t.length&&"="===t[2].charAt(t[2].length-1)&&(t[4]=" "+t[4]),v.test(e[0])))continue;t.push(e[0])}else t[t.length-1]+=u,a.test(t[t.length-1])&&(4===f[f.length-1]&&(t.length<2||v.test(t[t.length-2])?t.pop():t[t.length-1]=" ",e[0]=""),f.pop()),t[t.length-1]+=e[0]}return t.join("").trim()}(r),o.querySelector(r),document.head.createShadowRoot||document.head.attachShadow?n(r,",").reduce(((r,i)=>{var f=n(i.replace(/^\s+/g,"").replace(/\s*([>+~]+)\s*/g,"$1")," ").filter((r=>!!r)).map((r=>n(r,">"))),l=f.length-1,a=function(r,n,e){void 0===r&&(r=null);void 0===e&&(e=null);var u=[];if(e)u=e;else{var i=function(r){for(var n=0;n<r.length;n++){var e=r[n];u.push(e),e.shadowRoot&&i(e.shadowRoot.querySelectorAll("*"))}};n.shadowRoot&&i(n.shadowRoot.querySelectorAll("*")),i(n.querySelectorAll("*"))}return r?u.filter((n=>n.matches(r))):u}(f[l][f[l].length-1],o,t),v=function(r,n,i){return o=>{for(var t=n,f=o,l=!1;f&&!e(f);){var a=!0;if(1===r[t].length)a=f.matches(r[t]);else{var v=[].concat(r[t]).reverse(),c=f;for(var d of v){if(!c||!c.matches(d)){a=!1;break}c=u(c,i)}}if(a&&0===t){l=!0;break}a&&t--,f=u(f,i)}return l}}(f,l,o);return r=r.concat(a.filter(v))}),[]):o.querySelectorAll(r)}(r,0,i,o)}function n(r,n){return r.match(/\\?.|^$/g).reduce(((r,e)=>('"'!==e||r.sQuote?"'"!==e||r.quote?r.quote||r.sQuote||e!==n?r.a[r.a.length-1]+=e:r.a.push(""):(r.sQuote^=1,r.a[r.a.length-1]+=e):(r.quote^=1,r.a[r.a.length-1]+=e),r)),{a:[""]}).a}function e(r){return r.nodeType===Node.DOCUMENT_FRAGMENT_NODE||r.nodeType===Node.DOCUMENT_NODE}function u(r,n){var e=r.parentNode;return e&&e.host&&11===e.nodeType?e.host:e===n?null:e}var i="undefined"!=typeof window?window:void 0,o="undefined"!=typeof globalThis?globalThis:i;"undefined"==typeof self&&(o.self=o),"undefined"==typeof File&&(o.File=function(){});var t=null==o?void 0:o.navigator;null==o||o.document,null==o||o.location,null==o||o.fetch,null!=o&&o.XMLHttpRequest&&"withCredentials"in new o.XMLHttpRequest&&o.XMLHttpRequest,null==o||o.AbortController,null==t||t.userAgent;var f=Array.isArray,l=Object.prototype.toString,a=f||function(r){return"[object Array]"===l.call(r)},v=r=>void 0===r;var c=(r,n,e)=>{function u(u){for(var i=arguments.length,o=new Array(i>1?i-1:0),t=1;t<i;t++)o[t-1]=arguments[t];n((()=>{(0,e[u])(r,...o)}))}return{info:function(){for(var r=arguments.length,n=new Array(r),e=0;e<r;e++)n[e]=arguments[e];u("log",...n)},warn:function(){for(var r=arguments.length,n=new Array(r),e=0;e<r;e++)n[e]=arguments[e];u("warn",...n)},error:function(){for(var r=arguments.length,n=new Array(r),e=0;e<r;e++)n[e]=arguments[e];u("error",...n)},critical:function(){for(var n=arguments.length,u=new Array(n),i=0;i<n;i++)u[i]=arguments[i];e.error(r,...u)},createLogger:u=>c(r+" "+u,n,e)}};var d,s,g=i,w=(void 0===d&&(d=r=>r()),c("[Element Inference]",d,(void 0===s&&(s=console),{log:s.log.bind(s),warn:s.warn.bind(s),error:s.error.bind(s),debug:s.debug.bind(s)})));function y(r,n){try{var e=n.get(r);if(!v(e))return e;if(r.checkVisibility){var u=r.checkVisibility({checkOpacity:!0,checkVisibilityCSS:!0});return n.set(r,u),u}var i=g.getComputedStyle(r);if("none"===i.display||"hidden"===i.visibility||0===parseFloat(i.opacity))return n.set(r,!1),!1;for(var o=r.parentElement;o;){var t=n.get(o);if(v(t)){var f=g.getComputedStyle(o),l="none"!==f.display&&"hidden"!==f.visibility;if(n.set(o,l),!l)return!1;o=o.parentElement}else{if(!t)return!1;o=o.parentElement}}var a=r.getBoundingClientRect(),c=a.width>0||a.height>0||r.getClientRects().length>0;return n.set(r,c),c}catch(r){return!0}}function h(r,n){var e=function(r){var n,e=null==(n=r.innerText)?void 0:n.trim();return!e||e.length>250?null:e}(r);return(null==e?void 0:e.toLowerCase())===n.toLowerCase()}function*p(n,e,u){var i;try{i=r(n)}catch(r){return}for(var o of i){var t=o;e&&!h(t,e)||y(t,u)&&(yield t)}}function b(r,n){var e=0;for(var u of r){if(e===n)return u;e++}return null}function A(r){try{var n=JSON.parse(r.autoData);if(!a(null==n?void 0:n.textGroups)||!a(null==n?void 0:n.notextGroups))return w.error("Invalid autoData structure:",n),null;var{text:e,excludeText:u}=r,i=null!=e&&!u,o=(i?n.textGroups:n.notextGroups).sort(((r,n)=>r.cardinality-n.cardinality));if(0===o.length)return null;var t=new WeakMap;for(var f of o){var l=new Map,v=null,c=0;for(var{css:d,offset:s}of f.cssSelectors){var g,y=b(p(d,i?e:null,t),s);if(y){var h=(null!==(g=l.get(y))&&void 0!==g?g:0)+1;if(l.set(y,h),h>c&&(c=h,v=y,h>=Math.ceil(f.cssSelectors.length/2)))return v}}if(v)return v}return null}catch(r){return w.error("Error finding element:",r),null}}function k(r,n){if(void 0===n&&(n=4),!r)return null;for(var e=[],u=r;u&&e.length<n&&"BODY"!==u.tagName;){var i=u.tagName.toLowerCase();u.id?i+="#"+u.id:u.classList.length&&(i+="."+u.classList[0]),e.unshift(i),u=u.parentElement}return e.join(" > ")}export{y as elementIsVisible,A as findElement,k as getElementPath};
//# sourceMappingURL=element-inference.js.map
