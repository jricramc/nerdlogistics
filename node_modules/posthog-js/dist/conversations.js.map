{"version":3,"file":"conversations.js","sources":["../../../node_modules/.pnpm/preact@10.28.2/node_modules/preact/dist/preact.module.js","../../core/dist/utils/type-utils.mjs","../src/utils/globals.ts","../src/utils/logger.ts","../src/uuidv7.ts","../src/extensions/conversations/external/persistence.ts","../src/extensions/conversations/external/components/styles.ts","../src/extensions/conversations/external/components/OpenChatButton.tsx","../src/extensions/conversations/external/components/SendMessageButton.tsx","../src/extensions/conversations/external/components/CloseChatButton.tsx","../src/extensions/conversations/external/components/ConversationsWidget.tsx","../src/utils/index.ts","../src/utils/request-utils.ts","../src/extensions/conversations/external/index.tsx","../src/entrypoints/conversations.ts"],"sourcesContent":["var n,l,u,t,i,o,r,e,f,c,s,a,h,p={},v=[],y=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,d=Array.isArray;function w(n,l){for(var u in l)n[u]=l[u];return n}function g(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function _(l,u,t){var i,o,r,e={};for(r in u)\"key\"==r?i=u[r]:\"ref\"==r?o=u[r]:e[r]=u[r];if(arguments.length>2&&(e.children=arguments.length>3?n.call(arguments,2):t),\"function\"==typeof l&&null!=l.defaultProps)for(r in l.defaultProps)void 0===e[r]&&(e[r]=l.defaultProps[r]);return m(l,e,i,o,null)}function m(n,t,i,o,r){var e={type:n,props:t,key:i,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==r?++u:r,__i:-1,__u:0};return null==r&&null!=l.vnode&&l.vnode(e),e}function b(){return{current:null}}function k(n){return n.children}function x(n,l){this.props=n,this.context=l}function S(n,l){if(null==l)return n.__?S(n.__,n.__i+1):null;for(var u;l<n.__k.length;l++)if(null!=(u=n.__k[l])&&null!=u.__e)return u.__e;return\"function\"==typeof n.type?S(n):null}function C(n){var l,u;if(null!=(n=n.__)&&null!=n.__c){for(n.__e=n.__c.base=null,l=0;l<n.__k.length;l++)if(null!=(u=n.__k[l])&&null!=u.__e){n.__e=n.__c.base=u.__e;break}return C(n)}}function M(n){(!n.__d&&(n.__d=!0)&&i.push(n)&&!$.__r++||o!=l.debounceRendering)&&((o=l.debounceRendering)||r)($)}function $(){for(var n,u,t,o,r,f,c,s=1;i.length;)i.length>s&&i.sort(e),n=i.shift(),s=i.length,n.__d&&(t=void 0,o=void 0,r=(o=(u=n).__v).__e,f=[],c=[],u.__P&&((t=w({},o)).__v=o.__v+1,l.vnode&&l.vnode(t),O(u.__P,t,o,u.__n,u.__P.namespaceURI,32&o.__u?[r]:null,f,null==r?S(o):r,!!(32&o.__u),c),t.__v=o.__v,t.__.__k[t.__i]=t,N(f,t,c),o.__e=o.__=null,t.__e!=r&&C(t)));$.__r=0}function I(n,l,u,t,i,o,r,e,f,c,s){var a,h,y,d,w,g,_,m=t&&t.__k||v,b=l.length;for(f=P(u,l,m,f,b),a=0;a<b;a++)null!=(y=u.__k[a])&&(h=-1==y.__i?p:m[y.__i]||p,y.__i=a,g=O(n,y,h,i,o,r,e,f,c,s),d=y.__e,y.ref&&h.ref!=y.ref&&(h.ref&&B(h.ref,null,y),s.push(y.ref,y.__c||d,y)),null==w&&null!=d&&(w=d),(_=!!(4&y.__u))||h.__k===y.__k?f=A(y,f,n,_):\"function\"==typeof y.type&&void 0!==g?f=g:d&&(f=d.nextSibling),y.__u&=-7);return u.__e=w,f}function P(n,l,u,t,i){var o,r,e,f,c,s=u.length,a=s,h=0;for(n.__k=new Array(i),o=0;o<i;o++)null!=(r=l[o])&&\"boolean\"!=typeof r&&\"function\"!=typeof r?(\"string\"==typeof r||\"number\"==typeof r||\"bigint\"==typeof r||r.constructor==String?r=n.__k[o]=m(null,r,null,null,null):d(r)?r=n.__k[o]=m(k,{children:r},null,null,null):void 0===r.constructor&&r.__b>0?r=n.__k[o]=m(r.type,r.props,r.key,r.ref?r.ref:null,r.__v):n.__k[o]=r,f=o+h,r.__=n,r.__b=n.__b+1,e=null,-1!=(c=r.__i=L(r,u,f,a))&&(a--,(e=u[c])&&(e.__u|=2)),null==e||null==e.__v?(-1==c&&(i>s?h--:i<s&&h++),\"function\"!=typeof r.type&&(r.__u|=4)):c!=f&&(c==f-1?h--:c==f+1?h++:(c>f?h--:h++,r.__u|=4))):n.__k[o]=null;if(a)for(o=0;o<s;o++)null!=(e=u[o])&&0==(2&e.__u)&&(e.__e==t&&(t=S(e)),D(e,e));return t}function A(n,l,u,t){var i,o;if(\"function\"==typeof n.type){for(i=n.__k,o=0;i&&o<i.length;o++)i[o]&&(i[o].__=n,l=A(i[o],l,u,t));return l}n.__e!=l&&(t&&(l&&n.type&&!l.parentNode&&(l=S(n)),u.insertBefore(n.__e,l||null)),l=n.__e);do{l=l&&l.nextSibling}while(null!=l&&8==l.nodeType);return l}function H(n,l){return l=l||[],null==n||\"boolean\"==typeof n||(d(n)?n.some(function(n){H(n,l)}):l.push(n)),l}function L(n,l,u,t){var i,o,r,e=n.key,f=n.type,c=l[u],s=null!=c&&0==(2&c.__u);if(null===c&&null==e||s&&e==c.key&&f==c.type)return u;if(t>(s?1:0))for(i=u-1,o=u+1;i>=0||o<l.length;)if(null!=(c=l[r=i>=0?i--:o++])&&0==(2&c.__u)&&e==c.key&&f==c.type)return r;return-1}function T(n,l,u){\"-\"==l[0]?n.setProperty(l,null==u?\"\":u):n[l]=null==u?\"\":\"number\"!=typeof u||y.test(l)?u:u+\"px\"}function j(n,l,u,t,i){var o,r;n:if(\"style\"==l)if(\"string\"==typeof u)n.style.cssText=u;else{if(\"string\"==typeof t&&(n.style.cssText=t=\"\"),t)for(l in t)u&&l in u||T(n.style,l,\"\");if(u)for(l in u)t&&u[l]==t[l]||T(n.style,l,u[l])}else if(\"o\"==l[0]&&\"n\"==l[1])o=l!=(l=l.replace(f,\"$1\")),r=l.toLowerCase(),l=r in n||\"onFocusOut\"==l||\"onFocusIn\"==l?r.slice(2):l.slice(2),n.l||(n.l={}),n.l[l+o]=u,u?t?u.u=t.u:(u.u=c,n.addEventListener(l,o?a:s,o)):n.removeEventListener(l,o?a:s,o);else{if(\"http://www.w3.org/2000/svg\"==i)l=l.replace(/xlink(H|:h)/,\"h\").replace(/sName$/,\"s\");else if(\"width\"!=l&&\"height\"!=l&&\"href\"!=l&&\"list\"!=l&&\"form\"!=l&&\"tabIndex\"!=l&&\"download\"!=l&&\"rowSpan\"!=l&&\"colSpan\"!=l&&\"role\"!=l&&\"popover\"!=l&&l in n)try{n[l]=null==u?\"\":u;break n}catch(n){}\"function\"==typeof u||(null==u||!1===u&&\"-\"!=l[4]?n.removeAttribute(l):n.setAttribute(l,\"popover\"==l&&1==u?\"\":u))}}function F(n){return function(u){if(this.l){var t=this.l[u.type+n];if(null==u.t)u.t=c++;else if(u.t<t.u)return;return t(l.event?l.event(u):u)}}}function O(n,u,t,i,o,r,e,f,c,s){var a,h,p,v,y,_,m,b,S,C,M,$,P,A,H,L,T,j=u.type;if(void 0!==u.constructor)return null;128&t.__u&&(c=!!(32&t.__u),r=[f=u.__e=t.__e]),(a=l.__b)&&a(u);n:if(\"function\"==typeof j)try{if(b=u.props,S=\"prototype\"in j&&j.prototype.render,C=(a=j.contextType)&&i[a.__c],M=a?C?C.props.value:a.__:i,t.__c?m=(h=u.__c=t.__c).__=h.__E:(S?u.__c=h=new j(b,M):(u.__c=h=new x(b,M),h.constructor=j,h.render=E),C&&C.sub(h),h.state||(h.state={}),h.__n=i,p=h.__d=!0,h.__h=[],h._sb=[]),S&&null==h.__s&&(h.__s=h.state),S&&null!=j.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=w({},h.__s)),w(h.__s,j.getDerivedStateFromProps(b,h.__s))),v=h.props,y=h.state,h.__v=u,p)S&&null==j.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),S&&null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(S&&null==j.getDerivedStateFromProps&&b!==v&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(b,M),u.__v==t.__v||!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(b,h.__s,M)){for(u.__v!=t.__v&&(h.props=b,h.state=h.__s,h.__d=!1),u.__e=t.__e,u.__k=t.__k,u.__k.some(function(n){n&&(n.__=u)}),$=0;$<h._sb.length;$++)h.__h.push(h._sb[$]);h._sb=[],h.__h.length&&e.push(h);break n}null!=h.componentWillUpdate&&h.componentWillUpdate(b,h.__s,M),S&&null!=h.componentDidUpdate&&h.__h.push(function(){h.componentDidUpdate(v,y,_)})}if(h.context=M,h.props=b,h.__P=n,h.__e=!1,P=l.__r,A=0,S){for(h.state=h.__s,h.__d=!1,P&&P(u),a=h.render(h.props,h.state,h.context),H=0;H<h._sb.length;H++)h.__h.push(h._sb[H]);h._sb=[]}else do{h.__d=!1,P&&P(u),a=h.render(h.props,h.state,h.context),h.state=h.__s}while(h.__d&&++A<25);h.state=h.__s,null!=h.getChildContext&&(i=w(w({},i),h.getChildContext())),S&&!p&&null!=h.getSnapshotBeforeUpdate&&(_=h.getSnapshotBeforeUpdate(v,y)),L=a,null!=a&&a.type===k&&null==a.key&&(L=V(a.props.children)),f=I(n,d(L)?L:[L],u,t,i,o,r,e,f,c,s),h.base=u.__e,u.__u&=-161,h.__h.length&&e.push(h),m&&(h.__E=h.__=null)}catch(n){if(u.__v=null,c||null!=r)if(n.then){for(u.__u|=c?160:128;f&&8==f.nodeType&&f.nextSibling;)f=f.nextSibling;r[r.indexOf(f)]=null,u.__e=f}else{for(T=r.length;T--;)g(r[T]);z(u)}else u.__e=t.__e,u.__k=t.__k,n.then||z(u);l.__e(n,u,t)}else null==r&&u.__v==t.__v?(u.__k=t.__k,u.__e=t.__e):f=u.__e=q(t.__e,u,t,i,o,r,e,c,s);return(a=l.diffed)&&a(u),128&u.__u?void 0:f}function z(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(z)}function N(n,u,t){for(var i=0;i<t.length;i++)B(t[i],t[++i],t[++i]);l.__c&&l.__c(u,n),n.some(function(u){try{n=u.__h,u.__h=[],n.some(function(n){n.call(u)})}catch(n){l.__e(n,u.__v)}})}function V(n){return\"object\"!=typeof n||null==n||n.__b&&n.__b>0?n:d(n)?n.map(V):w({},n)}function q(u,t,i,o,r,e,f,c,s){var a,h,v,y,w,_,m,b=i.props||p,k=t.props,x=t.type;if(\"svg\"==x?r=\"http://www.w3.org/2000/svg\":\"math\"==x?r=\"http://www.w3.org/1998/Math/MathML\":r||(r=\"http://www.w3.org/1999/xhtml\"),null!=e)for(a=0;a<e.length;a++)if((w=e[a])&&\"setAttribute\"in w==!!x&&(x?w.localName==x:3==w.nodeType)){u=w,e[a]=null;break}if(null==u){if(null==x)return document.createTextNode(k);u=document.createElementNS(r,x,k.is&&k),c&&(l.__m&&l.__m(t,e),c=!1),e=null}if(null==x)b===k||c&&u.data==k||(u.data=k);else{if(e=e&&n.call(u.childNodes),!c&&null!=e)for(b={},a=0;a<u.attributes.length;a++)b[(w=u.attributes[a]).name]=w.value;for(a in b)if(w=b[a],\"children\"==a);else if(\"dangerouslySetInnerHTML\"==a)v=w;else if(!(a in k)){if(\"value\"==a&&\"defaultValue\"in k||\"checked\"==a&&\"defaultChecked\"in k)continue;j(u,a,null,w,r)}for(a in k)w=k[a],\"children\"==a?y=w:\"dangerouslySetInnerHTML\"==a?h=w:\"value\"==a?_=w:\"checked\"==a?m=w:c&&\"function\"!=typeof w||b[a]===w||j(u,a,w,b[a],r);if(h)c||v&&(h.__html==v.__html||h.__html==u.innerHTML)||(u.innerHTML=h.__html),t.__k=[];else if(v&&(u.innerHTML=\"\"),I(\"template\"==t.type?u.content:u,d(y)?y:[y],t,i,o,\"foreignObject\"==x?\"http://www.w3.org/1999/xhtml\":r,e,f,e?e[0]:i.__k&&S(i,0),c,s),null!=e)for(a=e.length;a--;)g(e[a]);c||(a=\"value\",\"progress\"==x&&null==_?u.removeAttribute(\"value\"):null!=_&&(_!==u[a]||\"progress\"==x&&!_||\"option\"==x&&_!=b[a])&&j(u,a,_,b[a],r),a=\"checked\",null!=m&&m!=u[a]&&j(u,a,m,b[a],r))}return u}function B(n,u,t){try{if(\"function\"==typeof n){var i=\"function\"==typeof n.__u;i&&n.__u(),i&&null==u||(n.__u=n(u))}else n.current=u}catch(n){l.__e(n,t)}}function D(n,u,t){var i,o;if(l.unmount&&l.unmount(n),(i=n.ref)&&(i.current&&i.current!=n.__e||B(i,null,u)),null!=(i=n.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(n){l.__e(n,u)}i.base=i.__P=null}if(i=n.__k)for(o=0;o<i.length;o++)i[o]&&D(i[o],u,t||\"function\"!=typeof n.type);t||g(n.__e),n.__c=n.__=n.__e=void 0}function E(n,l,u){return this.constructor(n,u)}function G(u,t,i){var o,r,e,f;t==document&&(t=document.documentElement),l.__&&l.__(u,t),r=(o=\"function\"==typeof i)?null:i&&i.__k||t.__k,e=[],f=[],O(t,u=(!o&&i||t).__k=_(k,null,[u]),r||p,p,t.namespaceURI,!o&&i?[i]:r?null:t.firstChild?n.call(t.childNodes):null,e,!o&&i?i:r?r.__e:t.firstChild,o,f),N(e,u,f)}function J(n,l){G(n,l,J)}function K(l,u,t){var i,o,r,e,f=w({},l.props);for(r in l.type&&l.type.defaultProps&&(e=l.type.defaultProps),u)\"key\"==r?i=u[r]:\"ref\"==r?o=u[r]:f[r]=void 0===u[r]&&null!=e?e[r]:u[r];return arguments.length>2&&(f.children=arguments.length>3?n.call(arguments,2):t),m(l.type,f,i||l.key,o||l.ref,null)}function Q(n){function l(n){var u,t;return this.getChildContext||(u=new Set,(t={})[l.__c]=this,this.getChildContext=function(){return t},this.componentWillUnmount=function(){u=null},this.shouldComponentUpdate=function(n){this.props.value!=n.value&&u.forEach(function(n){n.__e=!0,M(n)})},this.sub=function(n){u.add(n);var l=n.componentWillUnmount;n.componentWillUnmount=function(){u&&u.delete(n),l&&l.call(n)}}),n.children}return l.__c=\"__cC\"+h++,l.__=n,l.Provider=l.__l=(l.Consumer=function(n,l){return n.children(l)}).contextType=l,l}n=v.slice,l={__e:function(n,l,u,t){for(var i,o,r;l=l.__;)if((i=l.__c)&&!i.__)try{if((o=i.constructor)&&null!=o.getDerivedStateFromError&&(i.setState(o.getDerivedStateFromError(n)),r=i.__d),null!=i.componentDidCatch&&(i.componentDidCatch(n,t||{}),r=i.__d),r)return i.__E=i}catch(l){n=l}throw n}},u=0,t=function(n){return null!=n&&void 0===n.constructor},x.prototype.setState=function(n,l){var u;u=null!=this.__s&&this.__s!=this.state?this.__s:this.__s=w({},this.state),\"function\"==typeof n&&(n=n(w({},u),this.props)),n&&w(u,n),null!=n&&this.__v&&(l&&this._sb.push(l),M(this))},x.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),M(this))},x.prototype.render=k,i=[],r=\"function\"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,e=function(n,l){return n.__v.__b-l.__v.__b},$.__r=0,f=/(PointerCapture)$|Capture$/i,c=0,s=F(!1),a=F(!0),h=0;export{x as Component,k as Fragment,K as cloneElement,Q as createContext,_ as createElement,b as createRef,_ as h,J as hydrate,t as isValidElement,l as options,G as render,H as toChildArray};\n//# sourceMappingURL=preact.module.js.map\n","import { knownUnsafeEditableEvent } from \"../types.mjs\";\nimport { includes } from \"./string-utils.mjs\";\nconst nativeIsArray = Array.isArray;\nconst ObjProto = Object.prototype;\nconst type_utils_hasOwnProperty = ObjProto.hasOwnProperty;\nconst type_utils_toString = ObjProto.toString;\nconst isArray = nativeIsArray || function(obj) {\n    return '[object Array]' === type_utils_toString.call(obj);\n};\nconst isFunction = (x)=>'function' == typeof x;\nconst isNativeFunction = (x)=>isFunction(x) && -1 !== x.toString().indexOf('[native code]');\nconst isObject = (x)=>x === Object(x) && !isArray(x);\nconst isEmptyObject = (x)=>{\n    if (isObject(x)) {\n        for(const key in x)if (type_utils_hasOwnProperty.call(x, key)) return false;\n        return true;\n    }\n    return false;\n};\nconst isUndefined = (x)=>void 0 === x;\nconst isString = (x)=>'[object String]' == type_utils_toString.call(x);\nconst isEmptyString = (x)=>isString(x) && 0 === x.trim().length;\nconst isNull = (x)=>null === x;\nconst isNullish = (x)=>isUndefined(x) || isNull(x);\nconst isNumber = (x)=>'[object Number]' == type_utils_toString.call(x) && x === x;\nconst isPositiveNumber = (value)=>isNumber(value) && value > 0;\nconst isBoolean = (x)=>'[object Boolean]' === type_utils_toString.call(x);\nconst isFormData = (x)=>x instanceof FormData;\nconst isFile = (x)=>x instanceof File;\nconst isPlainError = (x)=>x instanceof Error;\nconst isKnownUnsafeEditableEvent = (x)=>includes(knownUnsafeEditableEvent, x);\nfunction isPrimitive(value) {\n    return null === value || 'object' != typeof value;\n}\nfunction isBuiltin(candidate, className) {\n    return Object.prototype.toString.call(candidate) === `[object ${className}]`;\n}\nfunction isError(candidate) {\n    switch(Object.prototype.toString.call(candidate)){\n        case '[object Error]':\n        case '[object Exception]':\n        case '[object DOMException]':\n        case '[object DOMError]':\n        case '[object WebAssembly.Exception]':\n            return true;\n        default:\n            return isInstanceOf(candidate, Error);\n    }\n}\nfunction isErrorEvent(event) {\n    return isBuiltin(event, 'ErrorEvent');\n}\nfunction isEvent(candidate) {\n    return !isUndefined(Event) && isInstanceOf(candidate, Event);\n}\nfunction isPlainObject(candidate) {\n    return isBuiltin(candidate, 'Object');\n}\nfunction isInstanceOf(candidate, base) {\n    try {\n        return candidate instanceof base;\n    } catch  {\n        return false;\n    }\n}\nconst yesLikeValues = [\n    true,\n    'true',\n    1,\n    '1',\n    'yes'\n];\nconst isYesLike = (val)=>includes(yesLikeValues, val);\nconst noLikeValues = [\n    false,\n    'false',\n    0,\n    '0',\n    'no'\n];\nconst isNoLike = (val)=>includes(noLikeValues, val);\nexport { type_utils_hasOwnProperty as hasOwnProperty, isArray, isBoolean, isBuiltin, isEmptyObject, isEmptyString, isError, isErrorEvent, isEvent, isFile, isFormData, isFunction, isKnownUnsafeEditableEvent, isNativeFunction, isNoLike, isNull, isNullish, isNumber, isObject, isPlainError, isPlainObject, isPositiveNumber, isPrimitive, isString, isUndefined, isYesLike, noLikeValues, yesLikeValues };\n","import type { PostHog } from '../posthog-core'\nimport { SessionIdManager } from '../sessionid'\nimport {\n    DeadClicksAutoCaptureConfig,\n    ExternalIntegrationKind,\n    Properties,\n    RemoteConfig,\n    SiteAppLoader,\n    SessionStartReason,\n} from '../types'\nimport type {\n    ConversationsRemoteConfig,\n    GetMessagesResponse,\n    GetTicketsOptions,\n    GetTicketsResponse,\n    MarkAsReadResponse,\n    SendMessageResponse,\n    UserProvidedTraits,\n} from '../posthog-conversations-types'\n// only importing types here, so won't affect the bundle\n// eslint-disable-next-line posthog-js/no-external-replay-imports\nimport type { SessionRecordingStatus, TriggerType } from '../extensions/replay/external/triggerMatching'\nimport { eventWithTime } from '../extensions/replay/types/rrweb-types'\nimport { ErrorTracking } from '@posthog/core'\n\n/*\n * Global helpers to protect access to browser globals in a way that is safer for different targets\n * like DOM, SSR, Web workers etc.\n *\n * NOTE: Typically we want the \"window\" but globalThis works for both the typical browser context as\n * well as other contexts such as the web worker context. Window is still exported for any bits that explicitly require it.\n * If in doubt - export the global you need from this file and use that as an optional value. This way the code path is forced\n * to handle the case where the global is not available.\n */\n\n// eslint-disable-next-line no-restricted-globals\nconst win: (Window & typeof globalThis) | undefined = typeof window !== 'undefined' ? window : undefined\n\nexport type AssignableWindow = Window &\n    typeof globalThis & {\n        /*\n         * Main PostHog instance\n         */\n        posthog: any\n\n        /*\n         * This is our contract between (potentially) lazily loaded extensions and the SDK\n         */\n        __PosthogExtensions__?: PostHogExtensions\n\n        /**\n         * When loading remote config, we assign it to this global configuration\n         * for ease of sharing it with the rest of the SDK\n         */\n        _POSTHOG_REMOTE_CONFIG?: Record<\n            string,\n            {\n                config: RemoteConfig\n                siteApps: SiteAppLoader[]\n            }\n        >\n\n        /**\n         * If this is set on the window, our logger will log to the console\n         * for ease of debugging. Used for testing purposes only.\n         *\n         * @see {Config.DEBUG} from config.ts\n         */\n        POSTHOG_DEBUG: any\n\n        // Exposed by the browser\n        doNotTrack: any\n\n        // See entrypoints/customizations.full.ts\n        posthogCustomizations: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/exception-autocapture.ts\n         *\n         * @deprecated use `__PosthogExtensions__.errorWrappingFunctions` instead\n         */\n        posthogErrorWrappingFunctions: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/posthog-recorder.ts\n         *\n         * @deprecated use `__PosthogExtensions__.rrweb` instead\n         */\n        rrweb: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/posthog-recorder.ts\n         *\n         * @deprecated use `__PosthogExtensions__.rrwebConsoleRecord` instead\n         */\n        rrwebConsoleRecord: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/posthog-recorder.ts\n         *\n         * @deprecated use `__PosthogExtensions__.getRecordNetworkPlugin` instead\n         */\n        getRecordNetworkPlugin: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/web-vitals.ts\n         *\n         * @deprecated use `__PosthogExtensions__.postHogWebVitalsCallbacks` instead\n         */\n        postHogWebVitalsCallbacks: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/tracing-headers.ts\n         *\n         * @deprecated use `__PosthogExtensions__.postHogTracingHeadersPatchFns` instead\n         */\n        postHogTracingHeadersPatchFns: any\n\n        /**\n         * This is a legacy way to expose these functions, but we still need to support it for backwards compatibility\n         * Can be removed once we drop support for 1.161.1\n         *\n         * See entrypoints/surveys.ts\n         *\n         * @deprecated use `__PosthogExtensions__.generateSurveys` instead\n         */\n        extendPostHogWithSurveys: any\n\n        /*\n         * These are used to handle our toolbar state.\n         * @see {Toolbar} from extensions/toolbar.ts\n         */\n        ph_load_toolbar: any\n        ph_load_editor: any\n        ph_toolbar_state: any\n    } & Record<`__$$ph_site_app_${string}`, any>\n\n/**\n * This is our contract between (potentially) lazily loaded extensions and the SDK\n * changes to this interface can be breaking changes for users of the SDK\n */\n\nexport type ExternalExtensionKind = 'intercom-integration' | 'crisp-chat-integration'\n\nexport type PostHogExtensionKind =\n    | 'toolbar'\n    | 'exception-autocapture'\n    | 'web-vitals'\n    | 'web-vitals-with-attribution'\n    | 'recorder'\n    | 'lazy-recorder'\n    | 'tracing-headers'\n    | 'surveys'\n    | 'logs'\n    | 'conversations'\n    | 'product-tours'\n    | 'dead-clicks-autocapture'\n    | 'remote-config'\n    | ExternalExtensionKind\n\nexport interface LazyLoadedSessionRecordingInterface {\n    start: (startReason?: SessionStartReason) => void\n    stop: () => void\n    sessionId: string\n    status: SessionRecordingStatus\n    onRRwebEmit: (rawEvent: eventWithTime) => void\n    log: (message: string, level: 'log' | 'warn' | 'error') => void\n    sdkDebugProperties: Properties\n    overrideLinkedFlag: () => void\n    overrideSampling: () => void\n    overrideTrigger: (triggerType: TriggerType) => void\n    isStarted: boolean\n    tryAddCustomEvent(tag: string, payload: any): boolean\n}\n\nexport interface LazyLoadedDeadClicksAutocaptureInterface {\n    start: (observerTarget: Node) => void\n    stop: () => void\n}\n\nexport interface LazyLoadedConversationsInterface {\n    // Widget control\n    show: () => void\n    hide: () => void\n    isVisible: () => boolean\n\n    // Lifecycle\n    reset: () => void\n\n    // API methods\n    sendMessage: (message: string, userTraits?: UserProvidedTraits, newTicket?: boolean) => Promise<SendMessageResponse>\n    getMessages: (ticketId?: string, after?: string) => Promise<GetMessagesResponse>\n    markAsRead: (ticketId?: string) => Promise<MarkAsReadResponse>\n    getTickets: (options?: GetTicketsOptions) => Promise<GetTicketsResponse>\n    getCurrentTicketId: () => string | null\n    getWidgetSessionId: () => string\n}\n\ninterface PostHogExtensions {\n    loadExternalDependency?: (\n        posthog: PostHog,\n        kind: PostHogExtensionKind,\n        callback: (error?: string | Event, event?: Event) => void\n    ) => void\n\n    loadSiteApp?: (posthog: PostHog, appUrl: string, callback: (error?: string | Event, event?: Event) => void) => void\n\n    errorWrappingFunctions?: {\n        wrapOnError: (captureFn: (props: ErrorTracking.ErrorProperties) => void) => () => void\n        wrapUnhandledRejection: (captureFn: (props: ErrorTracking.ErrorProperties) => void) => () => void\n        wrapConsoleError: (captureFn: (props: ErrorTracking.ErrorProperties) => void) => () => void\n    }\n    rrweb?: { record: any; version: string }\n    rrwebPlugins?: { getRecordConsolePlugin: any; getRecordNetworkPlugin?: any }\n    generateSurveys?: (posthog: PostHog, isSurveysEnabled: boolean) => any | undefined\n    generateProductTours?: (posthog: PostHog, isEnabled: boolean) => any | undefined\n    logs?: {\n        initializeLogs?: (posthog: PostHog) => any | undefined\n    }\n    postHogWebVitalsCallbacks?: {\n        onLCP: (metric: any) => void\n        onCLS: (metric: any) => void\n        onFCP: (metric: any) => void\n        onINP: (metric: any) => void\n    }\n    /**\n     * @deprecated\n     *\n     * this was introduced briefly, it is now always a no-op and only kept for backwards compatibility\n     */\n    loadWebVitalsCallbacks?: (useAttribution?: boolean) => PostHogExtensions['postHogWebVitalsCallbacks']\n    tracingHeadersPatchFns?: {\n        _patchFetch: (hostnames: string[], distinctId: string, sessionManager?: SessionIdManager) => () => void\n        _patchXHR: (hostnames: string[], distinctId: string, sessionManager?: SessionIdManager) => () => void\n    }\n    initDeadClicksAutocapture?: (\n        ph: PostHog,\n        config: DeadClicksAutoCaptureConfig\n    ) => LazyLoadedDeadClicksAutocaptureInterface\n    integrations?: {\n        [K in ExternalIntegrationKind]?: { start: (posthog: PostHog) => void; stop: () => void }\n    }\n    initSessionRecording?: (ph: PostHog) => LazyLoadedSessionRecordingInterface\n    initConversations?: (config: ConversationsRemoteConfig, posthog: PostHog) => LazyLoadedConversationsInterface\n}\n\nconst global: typeof globalThis | undefined = typeof globalThis !== 'undefined' ? globalThis : win\n\n// React Native polyfills for posthog-js compatibility\nif (typeof self === 'undefined') {\n    ;(global as any).self = global\n}\nif (typeof File === 'undefined') {\n    ;(global as any).File = function () {}\n}\n\nexport const ArrayProto = Array.prototype\nexport const nativeForEach = ArrayProto.forEach\nexport const nativeIndexOf = ArrayProto.indexOf\n\nexport const navigator = global?.navigator\nexport const document = global?.document\nexport const location = global?.location\nexport const fetch = global?.fetch\nexport const XMLHttpRequest =\n    global?.XMLHttpRequest && 'withCredentials' in new global.XMLHttpRequest() ? global.XMLHttpRequest : undefined\nexport const AbortController = global?.AbortController\nexport const userAgent = navigator?.userAgent\nexport const assignableWindow: AssignableWindow = win ?? ({} as any)\n\nexport { win as window }\n","import Config from '../config'\nimport { isUndefined } from '@posthog/core'\nimport { assignableWindow, window } from './globals'\nimport type { Logger } from '@posthog/core'\n\ntype CreateLoggerOptions = {\n    debugEnabled?: boolean\n}\n\ntype PosthogJsLogger = Omit<Logger, 'createLogger'> & {\n    _log: (level: 'log' | 'warn' | 'error', ...args: any[]) => void\n    uninitializedWarning: (methodName: string) => void\n    createLogger: (prefix: string, options?: CreateLoggerOptions) => PosthogJsLogger\n}\n\nconst _createLogger = (prefix: string, { debugEnabled }: CreateLoggerOptions = {}): PosthogJsLogger => {\n    const logger: PosthogJsLogger = {\n        _log: (level: 'log' | 'warn' | 'error', ...args: any[]) => {\n            if (\n                window &&\n                (Config.DEBUG || assignableWindow.POSTHOG_DEBUG || debugEnabled) &&\n                !isUndefined(window.console) &&\n                window.console\n            ) {\n                const consoleLog =\n                    '__rrweb_original__' in window.console[level]\n                        ? (window.console[level] as any)['__rrweb_original__']\n                        : window.console[level]\n\n                // eslint-disable-next-line no-console\n                consoleLog(prefix, ...args)\n            }\n        },\n\n        info: (...args: any[]) => {\n            logger._log('log', ...args)\n        },\n\n        warn: (...args: any[]) => {\n            logger._log('warn', ...args)\n        },\n\n        error: (...args: any[]) => {\n            logger._log('error', ...args)\n        },\n\n        critical: (...args: any[]) => {\n            // Critical errors are always logged to the console\n            // eslint-disable-next-line no-console\n            console.error(prefix, ...args)\n        },\n\n        uninitializedWarning: (methodName: string) => {\n            logger.error(`You must initialize PostHog before calling ${methodName}`)\n        },\n\n        createLogger: (additionalPrefix: string, options?: CreateLoggerOptions) =>\n            _createLogger(`${prefix} ${additionalPrefix}`, options),\n    }\n    return logger\n}\n\nexport const logger = _createLogger('[PostHog.js]')\n\nexport const createLogger = logger.createLogger\n","/**\n * uuidv7: An experimental implementation of the proposed UUID Version 7\n *\n * @license Apache-2.0\n * @copyright 2021-2023 LiosK\n * @packageDocumentation\n *\n * from https://github.com/LiosK/uuidv7/blob/e501462ea3d23241de13192ceae726956f9b3b7d/src/index.ts\n */\n\n// polyfill for IE11\nimport { window } from './utils/globals'\n\nimport { isNumber, isUndefined } from '@posthog/core'\n\nif (!Math.trunc) {\n    Math.trunc = function (v) {\n        return v < 0 ? Math.ceil(v) : Math.floor(v)\n    }\n}\n\n// polyfill for IE11\nif (!Number.isInteger) {\n    Number.isInteger = function (value) {\n        return isNumber(value) && isFinite(value) && Math.floor(value) === value\n    }\n}\n\nconst DIGITS = '0123456789abcdef'\n\n/** Represents a UUID as a 16-byte byte array. */\nexport class UUID {\n    /** @param bytes - The 16-byte byte array representation. */\n    constructor(readonly bytes: Readonly<Uint8Array>) {\n        if (bytes.length !== 16) {\n            throw new TypeError('not 128-bit length')\n        }\n    }\n\n    /**\n     * Builds a byte array from UUIDv7 field values.\n     *\n     * @param unixTsMs - A 48-bit `unix_ts_ms` field value.\n     * @param randA - A 12-bit `rand_a` field value.\n     * @param randBHi - The higher 30 bits of 62-bit `rand_b` field value.\n     * @param randBLo - The lower 32 bits of 62-bit `rand_b` field value.\n     */\n    static fromFieldsV7(unixTsMs: number, randA: number, randBHi: number, randBLo: number): UUID {\n        if (\n            !Number.isInteger(unixTsMs) ||\n            !Number.isInteger(randA) ||\n            !Number.isInteger(randBHi) ||\n            !Number.isInteger(randBLo) ||\n            unixTsMs < 0 ||\n            randA < 0 ||\n            randBHi < 0 ||\n            randBLo < 0 ||\n            unixTsMs > 0xffff_ffff_ffff ||\n            randA > 0xfff ||\n            randBHi > 0x3fff_ffff ||\n            randBLo > 0xffff_ffff\n        ) {\n            throw new RangeError('invalid field value')\n        }\n\n        const bytes = new Uint8Array(16)\n        bytes[0] = unixTsMs / 2 ** 40\n        bytes[1] = unixTsMs / 2 ** 32\n        bytes[2] = unixTsMs / 2 ** 24\n        bytes[3] = unixTsMs / 2 ** 16\n        bytes[4] = unixTsMs / 2 ** 8\n        bytes[5] = unixTsMs\n        bytes[6] = 0x70 | (randA >>> 8)\n        bytes[7] = randA\n        bytes[8] = 0x80 | (randBHi >>> 24)\n        bytes[9] = randBHi >>> 16\n        bytes[10] = randBHi >>> 8\n        bytes[11] = randBHi\n        bytes[12] = randBLo >>> 24\n        bytes[13] = randBLo >>> 16\n        bytes[14] = randBLo >>> 8\n        bytes[15] = randBLo\n        return new UUID(bytes)\n    }\n\n    /** @returns The 8-4-4-4-12 canonical hexadecimal string representation. */\n    toString(): string {\n        let text = ''\n        for (let i = 0; i < this.bytes.length; i++) {\n            text = text + DIGITS.charAt(this.bytes[i] >>> 4) + DIGITS.charAt(this.bytes[i] & 0xf)\n            if (i === 3 || i === 5 || i === 7 || i === 9) {\n                text += '-'\n            }\n        }\n\n        if (text.length !== 36) {\n            // We saw one customer whose bundling code was mangling the UUID generation\n            // rather than accept a bad UUID, we throw an error here.\n            throw new Error('Invalid UUIDv7 was generated')\n        }\n        return text\n    }\n\n    /** Creates an object from `this`. */\n    clone(): UUID {\n        return new UUID(this.bytes.slice(0))\n    }\n\n    /** Returns true if `this` is equivalent to `other`. */\n    equals(other: UUID): boolean {\n        return this.compareTo(other) === 0\n    }\n\n    /**\n     * Returns a negative integer, zero, or positive integer if `this` is less\n     * than, equal to, or greater than `other`, respectively.\n     */\n    compareTo(other: UUID): number {\n        for (let i = 0; i < 16; i++) {\n            const diff = this.bytes[i] - other.bytes[i]\n            if (diff !== 0) {\n                return Math.sign(diff)\n            }\n        }\n        return 0\n    }\n}\n\n/** Encapsulates the monotonic counter state. */\nclass V7Generator {\n    private _timestamp = 0\n    private _counter = 0\n    private readonly _random = new DefaultRandom()\n\n    /**\n     * Generates a new UUIDv7 object from the current timestamp, or resets the\n     * generator upon significant timestamp rollback.\n     *\n     * This method returns monotonically increasing UUIDs unless the up-to-date\n     * timestamp is significantly (by ten seconds or more) smaller than the one\n     * embedded in the immediately preceding UUID. If such a significant clock\n     * rollback is detected, this method resets the generator and returns a new\n     * UUID based on the current timestamp.\n     */\n    generate(): UUID {\n        const value = this.generateOrAbort()\n        if (!isUndefined(value)) {\n            return value\n        } else {\n            // reset state and resume\n            this._timestamp = 0\n            const valueAfterReset = this.generateOrAbort()\n            if (isUndefined(valueAfterReset)) {\n                throw new Error('Could not generate UUID after timestamp reset')\n            }\n            return valueAfterReset\n        }\n    }\n\n    /**\n     * Generates a new UUIDv7 object from the current timestamp, or returns\n     * `undefined` upon significant timestamp rollback.\n     *\n     * This method returns monotonically increasing UUIDs unless the up-to-date\n     * timestamp is significantly (by ten seconds or more) smaller than the one\n     * embedded in the immediately preceding UUID. If such a significant clock\n     * rollback is detected, this method aborts and returns `undefined`.\n     */\n    generateOrAbort(): UUID | undefined {\n        const MAX_COUNTER = 0x3ff_ffff_ffff\n        const ROLLBACK_ALLOWANCE = 10_000 // 10 seconds\n\n        const ts = Date.now()\n        if (ts > this._timestamp) {\n            this._timestamp = ts\n            this._resetCounter()\n        } else if (ts + ROLLBACK_ALLOWANCE > this._timestamp) {\n            // go on with previous timestamp if new one is not much smaller\n            this._counter++\n            if (this._counter > MAX_COUNTER) {\n                // increment timestamp at counter overflow\n                this._timestamp++\n                this._resetCounter()\n            }\n        } else {\n            // abort if clock went backwards to unbearable extent\n            return undefined\n        }\n\n        return UUID.fromFieldsV7(\n            this._timestamp,\n            Math.trunc(this._counter / 2 ** 30),\n            this._counter & (2 ** 30 - 1),\n            this._random.nextUint32()\n        )\n    }\n\n    /** Initializes the counter at a 42-bit random integer. */\n    private _resetCounter(): void {\n        this._counter = this._random.nextUint32() * 0x400 + (this._random.nextUint32() & 0x3ff)\n    }\n}\n\n/** A global flag to force use of cryptographically strong RNG. */\ndeclare const UUIDV7_DENY_WEAK_RNG: boolean\n\n/** Stores `crypto.getRandomValues()` available in the environment. */\nlet getRandomValues: <T extends Uint8Array | Uint32Array>(buffer: T) => T = (buffer) => {\n    // fall back on Math.random() unless the flag is set to true\n    // TRICKY: don't use the isUndefined method here as can't pass the reference\n    if (typeof UUIDV7_DENY_WEAK_RNG !== 'undefined' && UUIDV7_DENY_WEAK_RNG) {\n        throw new Error('no cryptographically strong RNG available')\n    }\n\n    for (let i = 0; i < buffer.length; i++) {\n        buffer[i] = Math.trunc(Math.random() * 0x1_0000) * 0x1_0000 + Math.trunc(Math.random() * 0x1_0000)\n    }\n    return buffer\n}\n\n// detect Web Crypto API\nif (window && !isUndefined(window.crypto) && crypto.getRandomValues) {\n    getRandomValues = (buffer) => crypto.getRandomValues(buffer)\n}\n\n/**\n * Wraps `crypto.getRandomValues()` and compatibles to enable buffering; this\n * uses a small buffer by default to avoid unbearable throughput decline in some\n * environments as well as the waste of time and space for unused values.\n */\nclass DefaultRandom {\n    private readonly _buffer = new Uint32Array(8)\n    private _cursor = Infinity\n    nextUint32(): number {\n        if (this._cursor >= this._buffer.length) {\n            getRandomValues(this._buffer)\n            this._cursor = 0\n        }\n        return this._buffer[this._cursor++]\n    }\n}\n\nlet defaultGenerator: V7Generator | undefined\n\n/**\n * Generates a UUIDv7 string.\n *\n * @returns The 8-4-4-4-12 canonical hexadecimal string representation\n * (\"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\").\n */\nexport const uuidv7 = (): string => uuidv7obj().toString()\n\n/** Generates a UUIDv7 object. */\nconst uuidv7obj = (): UUID => (defaultGenerator || (defaultGenerator = new V7Generator())).generate()\n\nexport const uuid7ToTimestampMs = (uuid: string): number => {\n    // remove hyphens\n    const hex = uuid.replace(/-/g, '')\n    // ensure that it's a version 7 UUID\n    if (hex.length !== 32) {\n        throw new Error('Not a valid UUID')\n    }\n    if (hex[12] !== '7') {\n        throw new Error('Not a UUIDv7')\n    }\n    // the first 6 bytes are the timestamp, which means that we can read only the first 12 hex characters\n    return parseInt(hex.substring(0, 12), 16)\n}\n","import { PostHog } from '../../../posthog-core'\nimport { UserProvidedTraits } from '../../../posthog-conversations-types'\nimport { createLogger } from '../../../utils/logger'\nimport { uuidv7 } from '../../../uuidv7'\n\nconst logger = createLogger('[ConversationsPersistence]')\n\n// Persistence keys - defined here in the lazy-loaded extension bundle\n// These keys are also listed in constants.ts PERSISTENCE_RESERVED_PROPERTIES\n// to prevent them from being included in event properties\nconst CONVERSATIONS_WIDGET_SESSION_ID = '$conversations_widget_session_id'\nconst CONVERSATIONS_TICKET_ID = '$conversations_ticket_id'\nconst CONVERSATIONS_WIDGET_STATE = '$conversations_widget_state'\nconst CONVERSATIONS_USER_TRAITS = '$conversations_user_traits'\n\n/**\n * ConversationsPersistence manages conversation-related data using PostHog's\n * core persistence layer. This ensures the data respects user's persistence\n * preferences (localStorage, cookie, sessionStorage, memory) and consent settings.\n */\nexport class ConversationsPersistence {\n    private _cachedWidgetSessionId: string | null = null\n\n    constructor(private readonly _posthog: PostHog) {}\n\n    /** Check if persistence is available and enabled */\n    private _isPersistenceAvailable(): boolean {\n        return !!this._posthog.persistence && !this._posthog.persistence.isDisabled?.()\n    }\n\n    /**\n     * Get or create the widget session ID (random UUID for access control).\n     * This ID is generated once per browser and persists across sessions.\n     * It is NOT tied to distinct_id - it stays the same even when user identifies.\n     *\n     * SECURITY: This is the key for access control. Only the browser that created\n     * the widget_session_id can access tickets associated with it.\n     */\n    getOrCreateWidgetSessionId(): string {\n        // Return cached value if available\n        if (this._cachedWidgetSessionId) {\n            return this._cachedWidgetSessionId\n        }\n\n        // Check if persistence is available\n        if (!this._isPersistenceAvailable()) {\n            // Fallback: generate a new one each time (won't persist)\n            // This is acceptable for SSR or environments without persistence\n            const sessionId = uuidv7()\n            logger.warn('Persistence not available, widget_session_id will not persist', { sessionId })\n            return sessionId\n        }\n\n        try {\n            let sessionId = this._posthog.persistence?.get_property(CONVERSATIONS_WIDGET_SESSION_ID)\n            if (!sessionId) {\n                sessionId = uuidv7()\n                this._posthog.persistence?.register({ [CONVERSATIONS_WIDGET_SESSION_ID]: sessionId })\n            }\n            this._cachedWidgetSessionId = sessionId\n            return sessionId\n        } catch (error) {\n            logger.error('Failed to get/create widget_session_id', error)\n            // Fallback: generate a new one (won't persist)\n            return uuidv7()\n        }\n    }\n\n    /**\n     * Clear the widget session ID (called on posthog.reset()).\n     * This will create a new session and lose access to previous tickets.\n     */\n    clearWidgetSessionId(): void {\n        this._cachedWidgetSessionId = null\n\n        if (!this._isPersistenceAvailable()) {\n            return\n        }\n\n        try {\n            this._posthog.persistence?.unregister(CONVERSATIONS_WIDGET_SESSION_ID)\n            logger.info('Cleared widget_session_id')\n        } catch (error) {\n            logger.error('Failed to clear widget_session_id', error)\n        }\n    }\n\n    /**\n     * Save the current ticket ID to persistence\n     */\n    saveTicketId(ticketId: string): void {\n        if (!this._isPersistenceAvailable()) {\n            logger.warn('Persistence not available')\n            return\n        }\n\n        try {\n            this._posthog.persistence?.register({ [CONVERSATIONS_TICKET_ID]: ticketId })\n            logger.info('Saved ticket ID', { ticketId })\n        } catch (error) {\n            logger.error('Failed to save ticket ID', error)\n        }\n    }\n\n    /**\n     * Load the current ticket ID from persistence\n     */\n    loadTicketId(): string | null {\n        if (!this._isPersistenceAvailable()) {\n            logger.warn('Persistence not available')\n            return null\n        }\n\n        try {\n            const ticketId = this._posthog.persistence?.get_property(CONVERSATIONS_TICKET_ID)\n            if (ticketId) {\n                logger.info('Loaded ticket ID', { ticketId })\n            }\n            return ticketId || null\n        } catch (error) {\n            logger.error('Failed to load ticket ID', error)\n            return null\n        }\n    }\n\n    /**\n     * Clear the current ticket ID from persistence\n     */\n    clearTicketId(): void {\n        if (!this._isPersistenceAvailable()) {\n            logger.warn('Persistence not available')\n            return\n        }\n\n        try {\n            this._posthog.persistence?.unregister(CONVERSATIONS_TICKET_ID)\n            logger.info('Cleared ticket ID')\n        } catch (error) {\n            logger.error('Failed to clear ticket ID', error)\n        }\n    }\n\n    /**\n     * Save widget state (open, closed)\n     */\n    saveWidgetState(state: 'open' | 'closed'): void {\n        if (!this._isPersistenceAvailable()) {\n            return\n        }\n\n        try {\n            this._posthog.persistence?.register({ [CONVERSATIONS_WIDGET_STATE]: state })\n        } catch (error) {\n            logger.error('Failed to save widget state', error)\n        }\n    }\n\n    /**\n     * Load widget state\n     */\n    loadWidgetState(): 'open' | 'closed' | null {\n        if (!this._isPersistenceAvailable()) {\n            return null\n        }\n\n        try {\n            const state = this._posthog.persistence?.get_property(CONVERSATIONS_WIDGET_STATE)\n            if (state === 'open' || state === 'closed') {\n                return state\n            }\n            return null\n        } catch (error) {\n            logger.error('Failed to load widget state', error)\n            return null\n        }\n    }\n\n    /**\n     * Save user-provided traits (name, email) to persistence\n     */\n    saveUserTraits(traits: UserProvidedTraits): void {\n        if (!this._isPersistenceAvailable()) {\n            logger.warn('Persistence not available')\n            return\n        }\n\n        try {\n            this._posthog.persistence?.register({ [CONVERSATIONS_USER_TRAITS]: traits })\n            logger.info('Saved user traits', { hasName: !!traits.name, hasEmail: !!traits.email })\n        } catch (error) {\n            logger.error('Failed to save user traits', error)\n        }\n    }\n\n    /**\n     * Load user-provided traits from persistence\n     */\n    loadUserTraits(): UserProvidedTraits | null {\n        if (!this._isPersistenceAvailable()) {\n            return null\n        }\n\n        try {\n            const traits = this._posthog.persistence?.get_property(CONVERSATIONS_USER_TRAITS) as\n                | UserProvidedTraits\n                | undefined\n            if (traits) {\n                logger.info('Loaded user traits', { hasName: !!traits.name, hasEmail: !!traits.email })\n                return traits\n            }\n            return null\n        } catch (error) {\n            logger.error('Failed to load user traits', error)\n            return null\n        }\n    }\n\n    /**\n     * Clear user-provided traits from persistence\n     */\n    clearUserTraits(): void {\n        if (!this._isPersistenceAvailable()) {\n            return\n        }\n\n        try {\n            this._posthog.persistence?.unregister(CONVERSATIONS_USER_TRAITS)\n            logger.info('Cleared user traits')\n        } catch (error) {\n            logger.error('Failed to clear user traits', error)\n        }\n    }\n\n    /**\n     * Clear all conversation-related data from persistence.\n     * This is called on posthog.reset() to start fresh.\n     */\n    clearAll(): void {\n        if (!this._isPersistenceAvailable()) {\n            return\n        }\n\n        try {\n            // Clear all conversation properties\n            this._posthog.persistence?.unregister(CONVERSATIONS_WIDGET_STATE)\n            this._posthog.persistence?.unregister(CONVERSATIONS_USER_TRAITS)\n            this._posthog.persistence?.unregister(CONVERSATIONS_TICKET_ID)\n\n            // Clear widget session ID last (this will lose access to previous tickets)\n            this.clearWidgetSessionId()\n\n            logger.info('Cleared all conversation data')\n        } catch (error) {\n            logger.error('Failed to clear conversation data', error)\n        }\n    }\n}\n","// Inline styles following PostHog design system\nexport const getStyles = (primaryColor: string) => ({\n    widget: {\n        position: 'fixed' as const,\n        bottom: '20px',\n        right: '20px',\n        zIndex: 2147483647,\n        fontFamily: '-apple-system, BlinkMacSystemFont, \"Inter\", \"Segoe UI\", \"Roboto\", Helvetica, Arial, sans-serif',\n    },\n    buttonContainer: {\n        position: 'relative' as const,\n    },\n    button: {\n        width: '50px',\n        height: '50px',\n        borderRadius: '50%',\n        background: primaryColor,\n        color: 'white',\n        border: 'none',\n        cursor: 'pointer',\n        boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        transition: 'transform 0.2s ease-out, box-shadow 0.2s ease-out',\n    },\n    unreadBadge: {\n        position: 'absolute' as const,\n        top: '-4px',\n        right: '-4px',\n        minWidth: '20px',\n        height: '20px',\n        borderRadius: '10px',\n        background: '#ef4444',\n        color: 'white',\n        fontSize: '11px',\n        fontWeight: 600,\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        padding: '0 5px',\n        boxShadow: '0 2px 4px rgba(0, 0, 0, 0.2)',\n        border: '2px solid white',\n        boxSizing: 'border-box' as const,\n    },\n    window: {\n        position: 'absolute' as const,\n        bottom: 0,\n        right: 0,\n        background: 'white',\n        borderRadius: '10px',\n        boxShadow: '0 10px 25px -3px rgba(0,0,0,0.12), 0 4px 12px -2px rgba(0,0,0,0.10)',\n        display: 'flex',\n        flexDirection: 'column' as const,\n        overflow: 'hidden',\n        transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',\n        //border: '1px solid #dcdcdc',\n        border: 'none',\n    },\n    windowOpen: {\n        width: '400px',\n        height: '600px',\n        maxHeight: 'calc(100vh - 100px)',\n    },\n    header: {\n        background: primaryColor,\n        color: 'white',\n        padding: '8px 12px',\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n        flexShrink: 0,\n    },\n    headerTitle: {\n        fontWeight: 500,\n        fontSize: '14px',\n    },\n    headerActions: {\n        display: 'flex',\n        gap: '4px',\n    },\n    headerButton: {\n        background: 'transparent',\n        border: 'none',\n        color: 'white',\n        cursor: 'pointer',\n        padding: '6px 8px',\n        fontSize: '16px',\n        lineHeight: 1,\n        borderRadius: '4px',\n        transition: 'background 0.2s ease-out',\n        opacity: 0.9,\n    },\n    messages: {\n        flex: 1,\n        overflowY: 'auto' as const,\n        padding: '14px',\n        display: 'flex',\n        flexDirection: 'column' as const,\n        gap: '8px',\n        background: 'white',\n    },\n    message: {\n        display: 'flex',\n        flexDirection: 'column' as const,\n        maxWidth: '85%',\n        animation: 'fadeIn 0.2s ease-out',\n    },\n    messageCustomer: {\n        alignSelf: 'flex-end',\n        alignItems: 'flex-end',\n    },\n    messageAgent: {\n        alignSelf: 'flex-start',\n        alignItems: 'flex-start',\n    },\n    messageAuthor: {\n        fontSize: '10px',\n        color: '#939393',\n        marginBottom: '4px',\n        fontWeight: 500,\n    },\n    messageContent: {\n        padding: '8px 12px',\n        borderRadius: '8px',\n        fontSize: '12px',\n        lineHeight: 1.5,\n        wordWrap: 'break-word' as const,\n        whiteSpace: 'pre-wrap' as const,\n    },\n    messageContentCustomer: {\n        background: primaryColor,\n        color: 'white',\n        borderBottomRightRadius: '2px',\n    },\n    messageContentAgent: {\n        background: 'white',\n        color: '#020617',\n        border: '1.5px solid #dcdcdc',\n        borderBottomLeftRadius: '2px',\n    },\n    messageTime: {\n        fontSize: '10px',\n        color: '#939393',\n        marginTop: '4px',\n        opacity: 0.8,\n    },\n    error: {\n        padding: '10px 16px',\n        background: '#fee2e2',\n        color: '#991b1b',\n        fontSize: '13px',\n        borderTop: '1px solid #fecaca',\n        borderBottom: '1px solid #fecaca',\n        textAlign: 'center' as const,\n        fontWeight: 500,\n    },\n    inputContainer: {\n        padding: '8px 12px',\n        background: 'white',\n        borderTop: '1px solid #dcdcdc',\n        display: 'flex',\n        gap: '8px',\n        alignItems: 'center', // Changed from flex-end to center to vertically align input and sendButton\n        flexShrink: 0,\n    },\n    input: {\n        flex: 1,\n        maxHeight: '120px',\n        fontSize: '14px',\n        resize: 'vertical',\n        fontFamily: 'inherit',\n        lineHeight: 1.5,\n        color: '#020617',\n        background: 'white',\n        border: 'none',\n        outline: 'none',\n        transition: 'border-color 0.2s ease-out, box-shadow 0.2s ease-out',\n        display: 'flex',\n        alignItems: 'center',\n        fieldSizing: 'content',\n    },\n    sendButton: {\n        width: '33px',\n        height: '33px', // Match input minHeight for vertical alignment\n        borderRadius: '10px',\n        background: primaryColor,\n        color: 'white',\n        border: 'none',\n        cursor: 'pointer',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        transition: 'all 0.2s ease-out',\n        boxShadow: '0 2px 0 rgba(0, 0, 0, 0.045)',\n        fontWeight: 700,\n        flexShrink: 0,\n    },\n    // Identification form styles\n    identificationForm: {\n        flex: 1,\n        display: 'flex',\n        flexDirection: 'column' as const,\n        padding: '24px',\n        background: '#eeeded',\n        overflowY: 'auto' as const,\n    },\n    formTitle: {\n        fontSize: '18px',\n        fontWeight: 600,\n        color: '#020617',\n        marginBottom: '8px',\n    },\n    formDescription: {\n        fontSize: '14px',\n        color: '#64748b',\n        marginBottom: '24px',\n        lineHeight: 1.5,\n    },\n    formField: {\n        marginBottom: '16px',\n    },\n    formLabel: {\n        display: 'block',\n        fontSize: '13px',\n        fontWeight: 500,\n        color: '#020617',\n        marginBottom: '6px',\n    },\n    formInput: {\n        width: '100%',\n        padding: '10px 12px',\n        border: '1px solid #dcdcdc',\n        borderRadius: '6px',\n        fontSize: '14px',\n        fontFamily: 'inherit',\n        color: '#020617',\n        background: 'white',\n        transition: 'border-color 0.2s ease-out, box-shadow 0.2s ease-out',\n        boxSizing: 'border-box' as const,\n    },\n    formInputError: {\n        borderColor: '#ef4444',\n    },\n    formError: {\n        fontSize: '12px',\n        color: '#ef4444',\n        marginTop: '4px',\n    },\n    formSubmitButton: {\n        width: '100%',\n        padding: '12px 16px',\n        borderRadius: '6px',\n        background: primaryColor,\n        color: 'white',\n        border: 'none',\n        cursor: 'pointer',\n        fontSize: '14px',\n        fontWeight: 600,\n        transition: 'all 0.2s ease-out',\n        marginTop: '8px',\n    },\n    formOptional: {\n        fontSize: '12px',\n        color: '#939393',\n        fontWeight: 400,\n    },\n})\n","import { getStyles } from './styles'\n\ninterface OpenChatButtonProps {\n    primaryColor: string\n    handleToggleOpen: () => void\n    unreadCount?: number\n}\n\nexport const OpenChatButton = ({ primaryColor, handleToggleOpen, unreadCount = 0 }: OpenChatButtonProps) => {\n    const styles = getStyles(primaryColor)\n    const displayCount = unreadCount > 99 ? '99+' : unreadCount.toString()\n\n    return (\n        <div style={styles.widget}>\n            <div style={styles.buttonContainer}>\n                <button\n                    style={styles.button}\n                    onClick={handleToggleOpen}\n                    aria-label={unreadCount > 0 ? `Open chat (${unreadCount} unread)` : 'Open chat'}\n                    onMouseEnter={(e) => {\n                        e.currentTarget.style.transform = 'scale(1.05)'\n                        e.currentTarget.style.boxShadow = '0 6px 20px rgba(0, 0, 0, 0.2)'\n                    }}\n                    onMouseLeave={(e) => {\n                        e.currentTarget.style.transform = 'scale(1)'\n                        e.currentTarget.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)'\n                    }}\n                >\n                    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                        <path\n                            d=\"M12 2C6.48 2 2 6.48 2 12C2 13.93 2.6 15.71 3.64 17.18L2.5 21.5L7.04 20.42C8.46 21.28 10.17 21.75 12 21.75C17.52 21.75 22 17.27 22 11.75C22 6.23 17.52 2 12 2Z\"\n                            fill=\"currentColor\"\n                        />\n                    </svg>\n                </button>\n                {unreadCount > 0 && <div style={styles.unreadBadge}>{displayCount}</div>}\n            </div>\n        </div>\n    )\n}\n","import { getStyles } from './styles'\n\ninterface SendMessageButtonProps {\n    primaryColor: string\n    inputValue: string\n    isLoading: boolean\n    handleSendMessage: () => void\n}\n\nexport const SendMessageButton = ({\n    primaryColor,\n    inputValue,\n    isLoading,\n    handleSendMessage,\n}: SendMessageButtonProps) => {\n    const styles = getStyles(primaryColor)\n    return (\n        <button\n            style={{\n                ...styles.sendButton,\n                opacity: !inputValue.trim() || isLoading ? 0.6 : 1,\n                cursor: !inputValue.trim() || isLoading ? 'not-allowed' : 'pointer',\n            }}\n            onClick={handleSendMessage}\n            disabled={!inputValue.trim() || isLoading}\n            aria-label=\"Send message\"\n            onMouseEnter={(e) => {\n                if (!e.currentTarget.disabled) {\n                    e.currentTarget.style.transform = 'scale(1.02)'\n                    e.currentTarget.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.1)'\n                }\n            }}\n            onMouseLeave={(e) => {\n                e.currentTarget.style.transform = 'scale(1)'\n                e.currentTarget.style.boxShadow = '0 2px 0 rgba(0, 0, 0, 0.045)'\n            }}\n        >\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path\n                    d=\"M2 10L18 2L10 18L8 11L2 10Z\"\n                    fill=\"currentColor\"\n                    stroke=\"currentColor\"\n                    strokeWidth=\"2\"\n                    strokeLinejoin=\"round\"\n                />\n            </svg>\n        </button>\n    )\n}\n","import { getStyles } from './styles'\n\ninterface CloseChatButtonProps {\n    primaryColor: string\n    handleClose: () => void\n}\n\nexport const CloseChatButton = ({ primaryColor, handleClose }: CloseChatButtonProps) => {\n    const styles = getStyles(primaryColor)\n    return (\n        <button\n            style={styles.headerButton}\n            onClick={handleClose}\n            aria-label=\"Close\"\n            onMouseEnter={(e) => {\n                e.currentTarget.style.background = 'rgba(255, 255, 255, 0.15)'\n                e.currentTarget.style.opacity = '1'\n            }}\n            onMouseLeave={(e) => {\n                e.currentTarget.style.background = 'transparent'\n                e.currentTarget.style.opacity = '0.9'\n            }}\n        >\n            \n        </button>\n    )\n}\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { h, Component, Fragment } from 'preact'\nimport {\n    ConversationsRemoteConfig,\n    Message,\n    ConversationsWidgetState,\n    UserProvidedTraits,\n} from '../../../../posthog-conversations-types'\nimport { createLogger } from '../../../../utils/logger'\nimport { getStyles } from './styles'\nimport { OpenChatButton } from './OpenChatButton'\nimport { SendMessageButton } from './SendMessageButton'\nimport { CloseChatButton } from './CloseChatButton'\n\nconst logger = createLogger('[ConversationsWidget]')\n\ninterface WidgetProps {\n    config: ConversationsRemoteConfig\n    initialState?: ConversationsWidgetState\n    initialUserTraits?: UserProvidedTraits | null\n    onSendMessage: (message: string) => Promise<void>\n    onStateChange?: (state: ConversationsWidgetState) => void\n    onIdentify?: (traits: UserProvidedTraits) => void\n}\n\ninterface WidgetState {\n    state: ConversationsWidgetState\n    messages: Message[]\n    inputValue: string\n    isLoading: boolean\n    error: string | null\n    showIdentificationForm: boolean\n    formName: string\n    formEmail: string\n    formEmailError: string | null\n    userTraits: UserProvidedTraits | null\n    unreadCount: number\n}\n\nexport class ConversationsWidget extends Component<WidgetProps, WidgetState> {\n    private _messagesEndRef: HTMLDivElement | null = null\n    private _inputRef: HTMLTextAreaElement | null = null\n\n    constructor(props: WidgetProps) {\n        super(props)\n\n        // Determine if we need to show the identification form\n        const userTraits = props.initialUserTraits || null\n        const needsIdentification = this._needsIdentification(props.config, userTraits)\n\n        this.state = {\n            state: props.initialState || 'closed',\n            messages: [],\n            inputValue: '',\n            isLoading: false,\n            error: null,\n            showIdentificationForm: needsIdentification,\n            formName: userTraits?.name || '',\n            formEmail: userTraits?.email || '',\n            formEmailError: null,\n            userTraits,\n            unreadCount: 0,\n        }\n    }\n\n    /**\n     * Check if we need to show the identification form\n     */\n    private _needsIdentification(config: ConversationsRemoteConfig, traits: UserProvidedTraits | null): boolean {\n        // If requireEmail is not set, no identification needed\n        if (!config.requireEmail) {\n            return false\n        }\n\n        // If we already have an email, no form needed\n        if (traits?.email) {\n            return false\n        }\n\n        return true\n    }\n\n    componentDidMount() {\n        // Add greeting message if no messages exist\n        if (this.state.messages.length === 0 && this.props.config.greetingText) {\n            this._addGreetingMessage()\n        }\n    }\n\n    componentDidUpdate(_prevProps: WidgetProps, prevState: WidgetState) {\n        // Scroll to bottom when messages change\n        if (this.state.messages.length !== prevState.messages.length) {\n            this._scrollToBottom()\n        }\n\n        // Notify parent of state changes\n        if (this.state.state !== prevState.state && this.props.onStateChange) {\n            this.props.onStateChange(this.state.state)\n        }\n\n        // Focus input and scroll to bottom when opening\n        if (this.state.state === 'open' && prevState.state !== 'open') {\n            this._focusInput()\n            this._scrollToBottom()\n        }\n    }\n\n    private _addGreetingMessage() {\n        const greetingMessage: Message = {\n            id: 'greeting',\n            content: this.props.config.greetingText || 'Hi! How can we help?',\n            author_type: 'AI',\n            author_name: 'Support',\n            created_at: new Date().toISOString(),\n            is_private: false,\n        }\n        this.setState({ messages: [greetingMessage] })\n    }\n\n    private _scrollToBottom() {\n        if (this._messagesEndRef) {\n            this._messagesEndRef.scrollIntoView({ behavior: 'smooth' })\n        }\n    }\n\n    private _focusInput() {\n        if (this._inputRef) {\n            this._inputRef.focus()\n        }\n    }\n\n    private _handleToggleOpen = () => {\n        this.setState((prevState) => ({\n            state: prevState.state === 'open' ? 'closed' : 'open',\n        }))\n    }\n\n    private _handleClose = () => {\n        this.setState({ state: 'closed' })\n    }\n\n    private _handleInputChange = (e: Event) => {\n        const target = e.target as HTMLTextAreaElement\n        this.setState({ inputValue: target.value })\n    }\n\n    private _handleKeyPress = (e: KeyboardEvent) => {\n        if (e.key === 'Enter' && !e.shiftKey) {\n            e.preventDefault()\n            this._handleSendMessage()\n        }\n    }\n\n    // Identification form handlers\n    private _handleFormNameChange = (e: Event) => {\n        const target = e.target as HTMLInputElement\n        this.setState({ formName: target.value })\n    }\n\n    private _handleFormEmailChange = (e: Event) => {\n        const target = e.target as HTMLInputElement\n        this.setState({ formEmail: target.value, formEmailError: null })\n    }\n\n    private _validateEmail(email: string): boolean {\n        // Basic email validation\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n        return emailRegex.test(email)\n    }\n\n    private _handleFormSubmit = (e: Event) => {\n        e.preventDefault()\n\n        const { formEmail, formName } = this.state\n        const { config, onIdentify } = this.props\n\n        // Validate email if required\n        if (config.requireEmail && !formEmail.trim()) {\n            this.setState({ formEmailError: 'Email is required' })\n            return\n        }\n\n        if (formEmail.trim() && !this._validateEmail(formEmail.trim())) {\n            this.setState({ formEmailError: 'Please enter a valid email address' })\n            return\n        }\n\n        // Create traits object\n        const traits: UserProvidedTraits = {}\n        if (formName.trim()) {\n            traits.name = formName.trim()\n        }\n        if (formEmail.trim()) {\n            traits.email = formEmail.trim()\n        }\n\n        // Update state and notify parent\n        this.setState({\n            userTraits: traits,\n            showIdentificationForm: false,\n        })\n\n        if (onIdentify) {\n            onIdentify(traits)\n        }\n    }\n\n    private _handleSendMessage = async () => {\n        const { inputValue } = this.state\n        const trimmedMessage = inputValue.trim()\n\n        if (!trimmedMessage) {\n            return\n        }\n\n        // Add user message to UI immediately\n        const userMessage: Message = {\n            id: `temp-${Date.now()}`,\n            content: trimmedMessage,\n            author_type: 'customer',\n            author_name: 'You',\n            created_at: new Date().toISOString(),\n            is_private: false,\n        }\n\n        this.setState({\n            messages: [...this.state.messages, userMessage],\n            inputValue: '',\n            isLoading: true,\n            error: null,\n        })\n\n        try {\n            await this.props.onSendMessage(trimmedMessage)\n            // Success - message will be updated via addMessage()\n            this.setState({ isLoading: false })\n        } catch (error) {\n            logger.error('Failed to send message', error)\n            this.setState({\n                isLoading: false,\n                error: error instanceof Error ? error.message : 'Failed to send message',\n            })\n\n            // Remove the temporary message on error\n            this.setState((prevState) => ({\n                messages: prevState.messages.filter((m) => m.id !== userMessage.id),\n            }))\n        }\n    }\n\n    private _formatTime(isoString: string): string {\n        const date = new Date(isoString)\n        const now = new Date()\n        const diffMs = now.getTime() - date.getTime()\n        const diffMins = Math.floor(diffMs / 60000)\n\n        if (diffMins < 1) {\n            return 'Just now'\n        } else if (diffMins < 60) {\n            return `${diffMins}m ago`\n        } else if (diffMins < 1440) {\n            return `${Math.floor(diffMins / 60)}h ago`\n        } else {\n            return date.toLocaleDateString()\n        }\n    }\n\n    /**\n     * Public method to add messages from outside\n     */\n    addMessages(messages: Message[]) {\n        this.setState((prevState) => {\n            // Filter out duplicates\n            const existingIds = new Set(prevState.messages.map((m) => m.id))\n            const newMessages = messages.filter((m) => !existingIds.has(m.id))\n\n            if (newMessages.length > 0) {\n                return {\n                    messages: [...prevState.messages, ...newMessages],\n                }\n            }\n            return null\n        })\n    }\n\n    /**\n     * Public method to show the widget\n     */\n    show() {\n        this.setState({ state: 'open' })\n    }\n\n    /**\n     * Public method to hide the widget\n     */\n    hide() {\n        this.setState({ state: 'closed' })\n    }\n\n    /**\n     * Public method to close the widget completely\n     */\n    close() {\n        this.setState({ state: 'closed' })\n    }\n\n    /**\n     * Get user traits (either provided via form or from props)\n     */\n    getUserTraits(): UserProvidedTraits | null {\n        return this.state.userTraits\n    }\n\n    /**\n     * Set the unread message count (called by manager)\n     */\n    setUnreadCount(count: number): void {\n        this.setState({ unreadCount: count })\n    }\n\n    private _renderIdentificationForm(styles: ReturnType<typeof getStyles>) {\n        const { config } = this.props\n        const { formName, formEmail, formEmailError } = this.state\n\n        const title = config.identificationFormTitle || 'Before we start...'\n        const description =\n            config.identificationFormDescription || 'Please provide your details so we can help you better.'\n        const showNameField = config.collectName !== false // Show by default unless explicitly disabled\n\n        return (\n            <div style={styles.identificationForm}>\n                <div style={styles.formTitle}>{title}</div>\n                <div style={styles.formDescription}>{description}</div>\n\n                <form onSubmit={this._handleFormSubmit}>\n                    {showNameField && (\n                        <div style={styles.formField}>\n                            <label style={styles.formLabel}>\n                                Name <span style={styles.formOptional}>(optional)</span>\n                            </label>\n                            <input\n                                type=\"text\"\n                                style={styles.formInput}\n                                value={formName}\n                                onInput={this._handleFormNameChange}\n                                placeholder=\"Your name\"\n                                autoComplete=\"name\"\n                            />\n                        </div>\n                    )}\n\n                    <div style={styles.formField}>\n                        <label style={styles.formLabel}>\n                            Email {!config.requireEmail && <span style={styles.formOptional}>(optional)</span>}\n                        </label>\n                        <input\n                            type=\"email\"\n                            style={{\n                                ...styles.formInput,\n                                ...(formEmailError ? styles.formInputError : {}),\n                            }}\n                            value={formEmail}\n                            onInput={this._handleFormEmailChange}\n                            placeholder=\"you@example.com\"\n                            autoComplete=\"email\"\n                        />\n                        {formEmailError && <div style={styles.formError}>{formEmailError}</div>}\n                    </div>\n\n                    <button\n                        type=\"submit\"\n                        style={styles.formSubmitButton}\n                        onMouseEnter={(e) => {\n                            e.currentTarget.style.opacity = '0.9'\n                        }}\n                        onMouseLeave={(e) => {\n                            e.currentTarget.style.opacity = '1'\n                        }}\n                    >\n                        Start Chat\n                    </button>\n                </form>\n            </div>\n        )\n    }\n\n    private _renderMessage(message: Message, styles: ReturnType<typeof getStyles>) {\n        const isCustomer = message.author_type === 'customer'\n        const messageStyle = {\n            ...styles.message,\n            ...(isCustomer ? styles.messageCustomer : styles.messageAgent),\n        }\n        const contentStyle = {\n            ...styles.messageContent,\n            ...(isCustomer ? styles.messageContentCustomer : styles.messageContentAgent),\n        }\n\n        return (\n            <div key={message.id} style={messageStyle}>\n                {!isCustomer && message.author_name && <div style={styles.messageAuthor}>{message.author_name}</div>}\n                <div style={contentStyle}>{message.content}</div>\n                <div style={styles.messageTime}>{this._formatTime(message.created_at)}</div>\n            </div>\n        )\n    }\n\n    render() {\n        const { config } = this.props\n        const { state, messages, inputValue, isLoading, error, showIdentificationForm } = this.state\n        const primaryColor = config.color || '#5375ff'\n        const placeholderText = config.placeholderText || 'Type your message...'\n        const styles = getStyles(primaryColor)\n\n        // Button only (closed state)\n        if (state === 'closed') {\n            return (\n                <OpenChatButton\n                    primaryColor={primaryColor}\n                    handleToggleOpen={this._handleToggleOpen}\n                    unreadCount={this.state.unreadCount}\n                />\n            )\n        }\n\n        // Open state\n        const windowStyle = {\n            ...styles.window,\n            ...styles.windowOpen,\n        }\n\n        return (\n            <div style={styles.widget}>\n                <div style={windowStyle}>\n                    {/* Header */}\n                    <div style={styles.header}>\n                        <div style={styles.headerTitle}>\n                            <span>Support Chat</span>\n                        </div>\n                        <div style={styles.headerActions}>\n                            <CloseChatButton primaryColor={primaryColor} handleClose={this._handleClose} />\n                        </div>\n                    </div>\n\n                    {/* Show identification form if needed, otherwise show chat */}\n                    {showIdentificationForm ? (\n                        this._renderIdentificationForm(styles)\n                    ) : (\n                        <>\n                            <div style={styles.messages}>\n                                {messages.map((message) => this._renderMessage(message, styles))}\n                                <div\n                                    ref={(el) => {\n                                        this._messagesEndRef = el\n                                    }}\n                                />\n                            </div>\n\n                            {/* Error message */}\n                            {error && <div style={styles.error}>{error}</div>}\n\n                            {/* Input */}\n                            <div style={styles.inputContainer}>\n                                <textarea\n                                    ref={(el) => {\n                                        this._inputRef = el\n                                    }}\n                                    style={styles.input}\n                                    placeholder={placeholderText}\n                                    value={inputValue}\n                                    onInput={this._handleInputChange}\n                                    onKeyPress={this._handleKeyPress}\n                                    rows={1}\n                                    disabled={isLoading}\n                                />\n                                <SendMessageButton\n                                    primaryColor={primaryColor}\n                                    inputValue={inputValue}\n                                    isLoading={isLoading}\n                                    handleSendMessage={this._handleSendMessage}\n                                />\n                            </div>\n                        </>\n                    )}\n                </div>\n            </div>\n        )\n    }\n}\n","import { Breaker, Properties } from '../types'\nimport { nativeForEach, nativeIndexOf } from './globals'\nimport { logger } from './logger'\nimport { isFormData, isNull, isNullish, isNumber, isString, hasOwnProperty, isArray } from '@posthog/core'\n\nconst breaker: Breaker = {}\n\nexport function eachArray<E = any>(\n    obj: E[] | null | undefined,\n    iterator: (value: E, key: number) => void | Breaker,\n    thisArg?: any\n): void {\n    if (isArray(obj)) {\n        if (nativeForEach && obj.forEach === nativeForEach) {\n            obj.forEach(iterator, thisArg)\n        } else if ('length' in obj && obj.length === +obj.length) {\n            for (let i = 0, l = obj.length; i < l; i++) {\n                if (i in obj && iterator.call(thisArg, obj[i], i) === breaker) {\n                    return\n                }\n            }\n        }\n    }\n}\n\n/**\n * @param {*=} obj\n * @param {function(...*)=} iterator\n * @param {Object=} thisArg\n */\nexport function each(obj: any, iterator: (value: any, key: any) => void | Breaker, thisArg?: any): void {\n    if (isNullish(obj)) {\n        return\n    }\n    if (isArray(obj)) {\n        return eachArray(obj, iterator, thisArg)\n    }\n    if (isFormData(obj)) {\n        for (const pair of obj.entries()) {\n            if (iterator.call(thisArg, pair[1], pair[0]) === breaker) {\n                return\n            }\n        }\n        return\n    }\n    for (const key in obj) {\n        if (hasOwnProperty.call(obj, key)) {\n            if (iterator.call(thisArg, obj[key], key) === breaker) {\n                return\n            }\n        }\n    }\n}\n\nexport const extend = function (obj: Record<string, any>, ...args: Record<string, any>[]): Record<string, any> {\n    eachArray(args, function (source) {\n        for (const prop in source) {\n            if (source[prop] !== void 0) {\n                obj[prop] = source[prop]\n            }\n        }\n    })\n    return obj\n}\n\nexport const extendArray = function <T>(obj: T[], ...args: T[][]): T[] {\n    eachArray(args, function (source) {\n        eachArray(source, function (item) {\n            obj.push(item)\n        })\n    })\n    return obj\n}\n\nexport const include = function (\n    obj: null | string | Array<any> | Record<string, any>,\n    target: any\n): boolean | Breaker {\n    let found = false\n    if (isNull(obj)) {\n        return found\n    }\n    if (nativeIndexOf && obj.indexOf === nativeIndexOf) {\n        return obj.indexOf(target) != -1\n    }\n    each(obj, function (value) {\n        if (found || (found = value === target)) {\n            return breaker\n        }\n        return\n    })\n    return found\n}\n\n/**\n * Object.entries() polyfill\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries\n */\nexport function entries<T = any>(obj: Record<string, T>): [string, T][] {\n    const ownProps = Object.keys(obj)\n    let i = ownProps.length\n    const resArray = new Array(i) // preallocate the Array\n\n    while (i--) {\n        resArray[i] = [ownProps[i], obj[ownProps[i]]]\n    }\n    return resArray\n}\n\nexport const trySafe = function <T>(fn: () => T): T | undefined {\n    try {\n        return fn()\n    } catch {\n        return undefined\n    }\n}\n\nexport const safewrap = function <F extends (...args: any[]) => any = (...args: any[]) => any>(f: F): F {\n    return function (...args) {\n        try {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            return f.apply(this, args)\n        } catch (e) {\n            logger.critical(\n                'Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A.'\n            )\n            logger.critical(e)\n        }\n    } as F\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unsafe-function-type\nexport const safewrapClass = function (klass: Function, functions: string[]): void {\n    for (let i = 0; i < functions.length; i++) {\n        klass.prototype[functions[i]] = safewrap(klass.prototype[functions[i]])\n    }\n}\n\nexport const stripEmptyProperties = function (p: Properties): Properties {\n    const ret: Properties = {}\n    each(p, function (v, k) {\n        if ((isString(v) && v.length > 0) || isNumber(v)) {\n            ret[k] = v\n        }\n    })\n    return ret\n}\n\n/**\n * Deep copies an object.\n * It handles cycles by replacing all references to them with `undefined`\n * Also supports customizing native values\n *\n * @param value\n * @param customizer\n * @returns {{}|undefined|*}\n */\nfunction deepCircularCopy<T extends Record<string, any> = Record<string, any>>(\n    value: T,\n    customizer?: <K extends keyof T = keyof T>(value: T[K], key?: K) => T[K]\n): T | undefined {\n    const COPY_IN_PROGRESS_SET = new Set()\n\n    function internalDeepCircularCopy(value: T, key?: string): T | undefined {\n        if (value !== Object(value)) return customizer ? customizer(value as any, key) : value // primitive value\n\n        if (COPY_IN_PROGRESS_SET.has(value)) return undefined\n        COPY_IN_PROGRESS_SET.add(value)\n        let result: T\n\n        if (isArray(value)) {\n            result = [] as any as T\n            eachArray(value, (it) => {\n                result.push(internalDeepCircularCopy(it))\n            })\n        } else {\n            result = {} as T\n            each(value, (val, key) => {\n                if (!COPY_IN_PROGRESS_SET.has(val)) {\n                    ;(result as any)[key] = internalDeepCircularCopy(val, key)\n                }\n            })\n        }\n        return result\n    }\n    return internalDeepCircularCopy(value)\n}\n\nexport function _copyAndTruncateStrings<T extends Record<string, any> = Record<string, any>>(\n    object: T,\n    maxStringLength: number | null\n): T {\n    return deepCircularCopy(object, (value: any) => {\n        if (isString(value) && !isNull(maxStringLength)) {\n            return (value as string).slice(0, maxStringLength)\n        }\n        return value\n    }) as T\n}\n\n// NOTE: Update PostHogConfig docs if you change this list\n// We will not try to catch all bullets here, but we should make an effort to catch the most common ones\n// You should be highly against adding more to this list, because ultimately customers can configure\n// their `cross_subdomain_cookie` setting to anything they want.\nconst EXCLUDED_FROM_CROSS_SUBDOMAIN_COOKIE = ['herokuapp.com', 'vercel.app', 'netlify.app']\nexport function isCrossDomainCookie(documentLocation: Location | undefined) {\n    const hostname = documentLocation?.hostname\n\n    if (!isString(hostname)) {\n        return false\n    }\n    // split and slice isn't a great way to match arbitrary domains,\n    // but it's good enough for ensuring we only match herokuapp.com when it is the TLD\n    // for the hostname\n    const lastTwoParts = hostname.split('.').slice(-2).join('.')\n\n    for (const excluded of EXCLUDED_FROM_CROSS_SUBDOMAIN_COOKIE) {\n        if (lastTwoParts === excluded) {\n            return false\n        }\n    }\n\n    return true\n}\n\nexport function find<T>(value: T[], predicate: (value: T) => boolean): T | undefined {\n    for (let i = 0; i < value.length; i++) {\n        if (predicate(value[i])) {\n            return value[i]\n        }\n    }\n    return undefined\n}\n\n// Use this instead of element.addEventListener to avoid eslint errors\n// this properly implements the default options for passive event listeners\nexport function addEventListener(\n    element: Window | Document | Element | undefined,\n    event: string,\n    callback: EventListener,\n    options?: AddEventListenerOptions\n): void {\n    const { capture = false, passive = true } = options ?? {}\n\n    // This is the only place where we are allowed to call this function\n    // because the whole idea is that we should be calling this instead of the built-in one\n    // eslint-disable-next-line posthog-js/no-add-event-listener\n    element?.addEventListener(event, callback, { capture, passive })\n}\n\n/**\n * Helper to migrate deprecated config fields to new field names with appropriate warnings\n * @param config - The config object to check\n * @param newField - The new field name to use\n * @param oldField - The deprecated field name to check for\n * @param defaultValue - The default value if neither field is set\n * @param loggerInstance - Optional logger instance for deprecation warnings\n * @returns The value to use (new field takes precedence over old field)\n */\nexport function migrateConfigField<T>(\n    config: Record<string, any>,\n    newField: string,\n    oldField: string,\n    defaultValue: T,\n    loggerInstance?: { warn: (message: string) => void }\n): T {\n    const hasNewField = newField in config && !isNullish(config[newField])\n    const hasOldField = oldField in config && !isNullish(config[oldField])\n\n    if (hasNewField) {\n        return config[newField]\n    }\n\n    if (hasOldField) {\n        if (loggerInstance) {\n            loggerInstance.warn(\n                `Config field '${oldField}' is deprecated. Please use '${newField}' instead. ` +\n                    `The old field will be removed in a future major version.`\n            )\n        }\n        return config[oldField]\n    }\n\n    return defaultValue\n}\n","import { each } from './'\n\nimport { isArray, isFile, isUndefined } from '@posthog/core'\nimport { logger } from './logger'\nimport { document } from './globals'\n\nconst localDomains = ['localhost', '127.0.0.1']\n\n/**\n * IE11 doesn't support `new URL`\n * so we can create an anchor element and use that to parse the URL\n * there's a lot of overlap between HTMLHyperlinkElementUtils and URL\n * meaning useful properties like `pathname` are available on both\n */\nexport const convertToURL = (url: string): HTMLAnchorElement | null => {\n    const location = document?.createElement('a')\n    if (isUndefined(location)) {\n        return null\n    }\n\n    location.href = url\n    return location\n}\n\nexport const formDataToQuery = function (formdata: Record<string, any> | FormData, arg_separator = '&'): string {\n    let use_val: string\n    let use_key: string\n    const tph_arr: string[] = []\n\n    each(formdata, function (val: File | string | undefined, key: string | undefined) {\n        // the key might be literally the string undefined for e.g. if {undefined: 'something'}\n        if (isUndefined(val) || isUndefined(key) || key === 'undefined') {\n            return\n        }\n\n        use_val = encodeURIComponent(isFile(val) ? val.name : val.toString())\n        use_key = encodeURIComponent(key)\n        tph_arr[tph_arr.length] = use_key + '=' + use_val\n    })\n\n    return tph_arr.join(arg_separator)\n}\n\n// NOTE: Once we get rid of IE11/op_mini we can start using URLSearchParams\nexport const getQueryParam = function (url: string, param: string): string {\n    const withoutHash: string = url.split('#')[0] || ''\n\n    // Split only on the first ? to sort problem out for those with multiple ?s\n    // and then remove them\n    const queryParams: string = withoutHash.split(/\\?(.*)/)[1] || ''\n    const cleanedQueryParams = queryParams.replace(/^\\?+/g, '')\n\n    const queryParts = cleanedQueryParams.split('&')\n    let keyValuePair\n\n    for (let i = 0; i < queryParts.length; i++) {\n        const parts = queryParts[i].split('=')\n        if (parts[0] === param) {\n            keyValuePair = parts\n            break\n        }\n    }\n\n    if (!isArray(keyValuePair) || keyValuePair.length < 2) {\n        return ''\n    } else {\n        let result = keyValuePair[1]\n        try {\n            result = decodeURIComponent(result)\n        } catch {\n            logger.error('Skipping decoding for malformed query param: ' + result)\n        }\n        return result.replace(/\\+/g, ' ')\n    }\n}\n\n// replace any query params in the url with the provided mask value. Tries to keep the URL as instant as possible,\n// including preserving malformed text in most cases\nexport const maskQueryParams = function <T extends string | undefined>(\n    url: T,\n    maskedParams: string[] | undefined,\n    mask: string\n): T extends string ? string : undefined {\n    if (!url || !maskedParams || !maskedParams.length) {\n        return url as any\n    }\n\n    const splitHash = url.split('#')\n    const withoutHash: string = splitHash[0] || ''\n    const hash = splitHash[1]\n\n    const splitQuery: string[] = withoutHash.split('?')\n    const queryString: string = splitQuery[1]\n    const urlWithoutQueryAndHash: string = splitQuery[0]\n    const queryParts = (queryString || '').split('&')\n\n    // use an array of strings rather than an object to preserve ordering and duplicates\n    const paramStrings: string[] = []\n\n    for (let i = 0; i < queryParts.length; i++) {\n        const keyValuePair = queryParts[i].split('=')\n        if (!isArray(keyValuePair)) {\n            continue\n        } else if (maskedParams.includes(keyValuePair[0])) {\n            paramStrings.push(keyValuePair[0] + '=' + mask)\n        } else {\n            paramStrings.push(queryParts[i])\n        }\n    }\n\n    let result = urlWithoutQueryAndHash\n    if (queryString != null) {\n        result += '?' + paramStrings.join('&')\n    }\n    if (hash != null) {\n        result += '#' + hash\n    }\n\n    return result as any\n}\n\nexport const _getHashParam = function (hash: string, param: string): string | null {\n    const matches = hash.match(new RegExp(param + '=([^&]*)'))\n    return matches ? matches[1] : null\n}\n\nexport const isLocalhost = (): boolean => {\n    return localDomains.includes(location.hostname)\n}\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { render, h } from 'preact'\nimport { isNumber } from '@posthog/core'\nimport {\n    ConversationsRemoteConfig,\n    ConversationsWidgetState,\n    UserProvidedTraits,\n    SendMessageResponse,\n    SendMessagePayload,\n    GetMessagesResponse,\n    MarkAsReadResponse,\n    GetTicketsOptions,\n    GetTicketsResponse,\n} from '../../../posthog-conversations-types'\nimport { PostHog } from '../../../posthog-core'\nimport { ConversationsManager as ConversationsManagerInterface } from '../posthog-conversations'\nimport { ConversationsPersistence } from './persistence'\nimport { ConversationsWidget } from './components/ConversationsWidget'\nimport { createLogger } from '../../../utils/logger'\nimport { document, window } from '../../../utils/globals'\nimport { formDataToQuery } from '../../../utils/request-utils'\n\nconst logger = createLogger('[ConversationsManager]')\n\nconst WIDGET_CONTAINER_ID = 'ph-conversations-widget-container'\nconst POLL_INTERVAL_MS = 5000 // 5 seconds\n\n/**\n * Extract hostname from a domain string (handles URLs and plain hostnames)\n */\nfunction extractHostname(domain: string): string | null {\n    // Remove protocol if present\n    let hostname = domain.replace(/^https?:\\/\\//, '')\n    // Remove path, query, port if present\n    hostname = hostname.split('/')[0].split('?')[0].split(':')[0]\n    return hostname || null\n}\n\n/**\n * Check if the current domain matches the allowed domains list.\n * Returns true if:\n * - domains is empty or not present (no restriction)\n * - current hostname matches any allowed domain\n */\nfunction isCurrentDomainAllowed(domains: string[] | undefined): boolean {\n    // No domain restriction - allow all\n    if (!domains || domains.length === 0) {\n        return true\n    }\n\n    const currentHostname = window?.location?.hostname\n    if (!currentHostname) {\n        // Can't determine hostname (SSR, etc.) - allow by default\n        return true\n    }\n\n    return domains.some((domain) => {\n        const allowedHostname = extractHostname(domain)\n        if (!allowedHostname) {\n            return false\n        }\n\n        if (allowedHostname.startsWith('*.')) {\n            // Wildcard match: *.example.com matches foo.example.com and example.com\n            const pattern = allowedHostname.slice(2) // Remove \"*.\"\n            return currentHostname.endsWith(`.${pattern}`) || currentHostname === pattern\n        }\n\n        // Exact match\n        return currentHostname === allowedHostname\n    })\n}\n\nexport class ConversationsManager implements ConversationsManagerInterface {\n    private _config: ConversationsRemoteConfig\n    private _persistence: ConversationsPersistence\n    private _widgetRef: ConversationsWidget | null = null\n    private _containerElement: HTMLDivElement | null = null\n    private _currentTicketId: string | null = null\n    private _pollIntervalId: number | null = null\n    private _lastMessageTimestamp: string | null = null\n    private _isPolling: boolean = false\n    private _unsubscribeIdentifyListener: (() => void) | null = null\n    private _unreadCount: number = 0\n    // SECURITY: widget_session_id is the key for access control\n    // This is a random UUID that only this browser knows\n    private _widgetSessionId: string\n    private _isWidgetEnabled: boolean\n    private _isDomainAllowed: boolean\n    private _isWidgetRendered: boolean = false\n\n    constructor(\n        config: ConversationsRemoteConfig,\n        private readonly _posthog: PostHog\n    ) {\n        this._config = config\n        this._persistence = new ConversationsPersistence(_posthog)\n        // Get or create widget_session_id - this stays the same even when user identifies\n        this._widgetSessionId = this._persistence.getOrCreateWidgetSessionId()\n\n        // Determine if widget should be shown based on config and domain\n        this._isWidgetEnabled = config.widgetEnabled === true\n        this._isDomainAllowed = isCurrentDomainAllowed(config.domains)\n\n        logger.info('ConversationsManager initialized', {\n            config,\n            widgetSessionId: this._widgetSessionId,\n            isWidgetEnabled: this._isWidgetEnabled,\n            isDomainAllowed: this._isDomainAllowed,\n        })\n\n        this._initialize()\n    }\n\n    /**\n     * Send a message programmatically via the API\n     * Creates a new ticket if none exists or if newTicket is true\n     *\n     * @param message - The message text to send\n     * @param userTraits - Optional user identification data (name, email)\n     * @param newTicket - If true, forces creation of a new ticket (ignores current ticket)\n     * @returns Promise with the response including ticket_id and message_id\n     */\n    async sendMessage(\n        message: string,\n        userTraits?: UserProvidedTraits,\n        newTicket?: boolean\n    ): Promise<SendMessageResponse> {\n        // Determine which ticket to use\n        // If newTicket is true, force creation of new ticket by sending null\n        // Otherwise use current ticket ID (which may be null if no ticket exists yet)\n        const ticketId = newTicket ? null : this._currentTicketId\n\n        // Track if this is creating a new ticket\n        const isNewTicket = !ticketId\n\n        const token = this._config.token\n\n        // eslint-disable-next-line compat/compat\n        return new Promise((resolve, reject) => {\n            const distinctId = this._posthog.get_distinct_id()\n            const personProperties = this._posthog.persistence?.props || {}\n\n            // Priority for traits:\n            // 1. User-provided traits from the widget form\n            // 2. PostHog person properties\n            const name = userTraits?.name || personProperties.$name || personProperties.name || null\n            const email = userTraits?.email || personProperties.$email || personProperties.email || null\n\n            const payload: Partial<SendMessagePayload> = {\n                widget_session_id: this._widgetSessionId,\n                // distinct_id is only used for Person linking, not access control\n                distinct_id: distinctId,\n                message: message.trim(),\n                traits: {\n                    name,\n                    email,\n                },\n                ticket_id: ticketId,\n            }\n\n            try {\n                // Capture session ID - sent with every message\n                const capturedSessionId = this._posthog.get_session_id()\n                if (capturedSessionId) {\n                    payload.session_id = capturedSessionId\n                }\n\n                // Capture session replay URL with timestamp - sent with every message\n                const replayUrl = this._posthog.get_session_replay_url({\n                    withTimestamp: true,\n                    timestampLookBack: 30,\n                })\n\n                // Capture current URL - only for new tickets to record where user started\n                const currentUrl = isNewTicket ? window?.location?.href : undefined\n\n                if (replayUrl || currentUrl) {\n                    payload.session_context = {\n                        session_replay_url: replayUrl || undefined,\n                        current_url: currentUrl || undefined,\n                    }\n                }\n            } catch (error) {\n                // Log error but don't fail message sending\n                logger.warn('Failed to capture session context', error)\n            }\n\n            this._posthog._send_request({\n                url: this._posthog.requestRouter.endpointFor('api', '/api/conversations/v1/widget/message'),\n                method: 'POST',\n                data: payload,\n                headers: {\n                    'X-Conversations-Token': token,\n                },\n                callback: (response) => {\n                    if (response.statusCode === 429) {\n                        reject(new Error('Too many requests. Please wait before trying again.'))\n                        return\n                    }\n\n                    if (response.statusCode !== 200 && response.statusCode !== 201) {\n                        const errorMsg = response.json?.detail || response.json?.message || 'Failed to send message'\n                        logger.error('Failed to send message', { status: response.statusCode })\n                        reject(new Error(errorMsg))\n                        return\n                    }\n\n                    if (!response.json) {\n                        reject(new Error('Invalid response from server'))\n                        return\n                    }\n\n                    const data = response.json as SendMessageResponse\n\n                    // Update current ticket ID if this was a new ticket\n                    // This happens when: 1) No ticket existed, or 2) User forced new ticket creation\n                    if (isNewTicket && data.ticket_id) {\n                        this._currentTicketId = data.ticket_id\n                        this._persistence.saveTicketId(data.ticket_id)\n                        logger.info('New ticket created', {\n                            ticketId: data.ticket_id,\n                            forced: newTicket === true,\n                        })\n                    }\n\n                    // Track message sent\n                    this._posthog.capture('$conversations_message_sent', {\n                        ticketId: data.ticket_id,\n                        isNewTicket: isNewTicket,\n                        messageLength: message.length,\n                    })\n\n                    // Update last message timestamp\n                    this._lastMessageTimestamp = data.created_at\n\n                    resolve(data)\n                },\n            })\n        })\n    }\n\n    /**\n     * Switch to a different ticket if an explicit ticketId is provided\n     * This ensures subsequent operations (sendMessage, etc.) use the correct ticket\n     */\n    private _switchToTicketIfNeeded(ticketId: string | undefined): void {\n        if (ticketId && ticketId !== this._currentTicketId) {\n            this._currentTicketId = ticketId\n            this._persistence.saveTicketId(ticketId)\n            // Reset last message timestamp when switching tickets\n            this._lastMessageTimestamp = null\n        }\n    }\n\n    /** Fetch messages via the API */\n    async getMessages(ticketId?: string, after?: string): Promise<GetMessagesResponse> {\n        // Use provided ticketId or fall back to current ticket\n        const targetTicketId = ticketId || this._currentTicketId\n\n        if (!targetTicketId) {\n            throw new Error('No ticket ID provided and no active conversation')\n        }\n\n        // Switch to this ticket if explicitly provided\n        this._switchToTicketIfNeeded(ticketId)\n\n        const token = this._config.token\n\n        // eslint-disable-next-line compat/compat\n        return new Promise((resolve, reject) => {\n            // SECURITY: widget_session_id is required for access control\n            // distinct_id is NOT sent for getMessages - access is controlled by widget_session_id only\n            const queryParams: Record<string, string> = {\n                widget_session_id: this._widgetSessionId,\n                limit: '50',\n            }\n\n            if (after) {\n                queryParams.after = after\n            }\n\n            this._posthog._send_request({\n                url: this._posthog.requestRouter.endpointFor(\n                    'api',\n                    `/api/conversations/v1/widget/messages/${targetTicketId}?${formDataToQuery(queryParams)}`\n                ),\n                method: 'GET',\n                headers: {\n                    'X-Conversations-Token': token,\n                },\n                callback: (response) => {\n                    if (response.statusCode === 429) {\n                        reject(new Error('Too many requests. Please wait before trying again.'))\n                        return\n                    }\n\n                    if (response.statusCode !== 200) {\n                        const errorMsg = response.json?.detail || response.json?.message || 'Failed to fetch messages'\n                        logger.error('Failed to fetch messages', { status: response.statusCode })\n                        reject(new Error(errorMsg))\n                        return\n                    }\n\n                    if (!response.json) {\n                        reject(new Error('Invalid response from server'))\n                        return\n                    }\n\n                    const data = response.json as GetMessagesResponse\n                    resolve(data)\n                },\n            })\n        })\n    }\n\n    /** Mark messages as read via the API */\n    async markAsRead(ticketId?: string): Promise<MarkAsReadResponse> {\n        // Use provided ticketId or fall back to current ticket\n        const targetTicketId = ticketId || this._currentTicketId\n\n        if (!targetTicketId) {\n            throw new Error('No ticket ID provided and no active conversation')\n        }\n\n        // Switch to this ticket if explicitly provided\n        this._switchToTicketIfNeeded(ticketId)\n\n        const token = this._config.token\n\n        logger.info('Marking messages as read', { ticketId: targetTicketId })\n\n        // eslint-disable-next-line compat/compat\n        return new Promise((resolve, reject) => {\n            this._posthog._send_request({\n                url: this._posthog.requestRouter.endpointFor(\n                    'api',\n                    `/api/conversations/v1/widget/messages/${targetTicketId}/read`\n                ),\n                method: 'POST',\n                data: {\n                    widget_session_id: this._widgetSessionId,\n                },\n                headers: {\n                    'X-Conversations-Token': token,\n                },\n                callback: (response) => {\n                    if (response.statusCode === 429) {\n                        reject(new Error('Too many requests. Please wait before trying again.'))\n                        return\n                    }\n\n                    if (response.statusCode !== 200) {\n                        const errorMsg =\n                            response.json?.detail || response.json?.message || 'Failed to mark messages as read'\n                        logger.error('Failed to mark messages as read', { status: response.statusCode })\n                        reject(new Error(errorMsg))\n                        return\n                    }\n\n                    if (!response.json) {\n                        reject(new Error('Invalid response from server'))\n                        return\n                    }\n\n                    const data = response.json as MarkAsReadResponse\n                    resolve(data)\n                },\n            })\n        })\n    }\n\n    /**\n     * Initialize the conversations manager.\n     * Always initializes persistence and event listeners for API usage.\n     * Only renders the widget if widgetEnabled is true AND domain is allowed.\n     */\n    private _initialize(): void {\n        if (!document || !window) {\n            logger.info('Conversations not available: Document or window not available')\n            return\n        }\n\n        // Load any existing ticket ID from localStorage\n        this._currentTicketId = this._persistence.loadTicketId()\n        logger.info('Loaded ticket ID from storage', { ticketId: this._currentTicketId })\n\n        // Track conversations API loaded (separate from widget loaded)\n        this._posthog.capture('$conversations_loaded', {\n            hasExistingTicket: !!this._currentTicketId,\n            widgetEnabled: this._isWidgetEnabled,\n            domainAllowed: this._isDomainAllowed,\n        })\n\n        // Only render widget if both widgetEnabled and domain is allowed\n        if (this._isWidgetEnabled && this._isDomainAllowed) {\n            this._initializeWidget()\n        } else {\n            logger.info('Widget not rendered', {\n                widgetEnabled: this._isWidgetEnabled,\n                domainAllowed: this._isDomainAllowed,\n            })\n        }\n\n        // Listen for identify events to handle distinct_id changes\n        this._setupIdentifyListener()\n    }\n\n    /**\n     * Initialize and render the widget UI\n     */\n    private _initializeWidget(): void {\n        if (this._isWidgetRendered) {\n            return // Already rendered\n        }\n\n        const savedState = this._persistence.loadWidgetState()\n        let initialState: ConversationsWidgetState = 'closed'\n        if (savedState === 'open') {\n            initialState = 'open'\n        }\n\n        // Get initial user traits (from PostHog person properties or saved)\n        const initialUserTraits = this._getInitialUserTraits()\n\n        // Render the widget\n        this._renderWidget(initialState, initialUserTraits)\n        this._isWidgetRendered = true\n\n        // Track widget initialization\n        this._posthog.capture('$conversations_widget_loaded', {\n            hasExistingTicket: !!this._currentTicketId,\n            initialState: initialState,\n            hasUserTraits: !!initialUserTraits,\n        })\n\n        // Set up polling and load messages only when widget is rendered\n        // If we have a ticket, load its messages\n        if (this._currentTicketId) {\n            this._loadMessages()\n        }\n\n        // Start polling for messages to keep widget UI updated\n        this._startPolling()\n    }\n\n    /**\n     * Get initial user traits from PostHog or localStorage\n     */\n    private _getInitialUserTraits(): UserProvidedTraits | null {\n        // First, check PostHog's person properties\n        const personProperties = this._posthog.persistence?.props || {}\n        const posthogName = personProperties.$name || personProperties.name\n        const posthogEmail = personProperties.$email || personProperties.email\n\n        // If we have traits from PostHog, use those\n        if (posthogName || posthogEmail) {\n            return {\n                name: posthogName || undefined,\n                email: posthogEmail || undefined,\n            }\n        }\n\n        // Otherwise, check localStorage for previously saved traits\n        const savedTraits = this._persistence.loadUserTraits()\n        if (savedTraits && (savedTraits.name || savedTraits.email)) {\n            return savedTraits\n        }\n\n        return null\n    }\n\n    /**\n     * Handle user identification from the widget form\n     */\n    private _handleIdentify = (traits: UserProvidedTraits): void => {\n        // Save traits to localStorage\n        this._persistence.saveUserTraits(traits)\n\n        // Track identification\n        this._posthog.capture('$conversations_user_identified', {\n            hasName: !!traits.name,\n            hasEmail: !!traits.email,\n        })\n    }\n\n    /**\n     * Handle sending a message from the widget\n     */\n    private _handleSendMessage = async (message: string): Promise<void> => {\n        // Get user traits from the widget\n        const userTraits = this._widgetRef?.getUserTraits() || undefined\n\n        try {\n            // Call the public API method (which handles tracking and state updates)\n            await this.sendMessage(message, userTraits)\n\n            // Poll for response immediately\n            setTimeout(() => this._pollMessages(), 1000)\n        } catch (error) {\n            logger.error('Failed to send message', error)\n            throw error\n        }\n    }\n\n    /**\n     * Handle widget state changes\n     */\n    private _handleStateChange = (state: ConversationsWidgetState): void => {\n        logger.info('Widget state changed', { state })\n\n        // Track state changes\n        this._posthog.capture('$conversations_widget_state_changed', {\n            state: state,\n            ticketId: this._currentTicketId,\n        })\n\n        // Save state to localStorage\n        this._persistence.saveWidgetState(state)\n\n        // Mark messages as read when widget opens\n        if (state === 'open') {\n            if (this._unreadCount > 0 && this._currentTicketId) {\n                this._markMessagesAsRead()\n            }\n        }\n    }\n\n    /**\n     * Mark messages as read\n     */\n    private async _markMessagesAsRead(): Promise<void> {\n        if (!this._currentTicketId) {\n            return\n        }\n\n        try {\n            const response = await this.markAsRead(this._currentTicketId || undefined)\n            this._unreadCount = response.unread_count\n            // Update the widget to reflect the new unread count\n            this._widgetRef?.setUnreadCount(0)\n            logger.info('Messages marked as read', { unreadCount: response.unread_count })\n        } catch (error) {\n            logger.error('Failed to mark messages as read', error)\n        }\n    }\n\n    /**\n     * Load messages for the current ticket\n     */\n    private async _loadMessages(): Promise<void> {\n        if (!this._currentTicketId) {\n            return\n        }\n\n        try {\n            const response = await this.getMessages(\n                this._currentTicketId || undefined,\n                this._lastMessageTimestamp || undefined\n            )\n\n            // Update unread count from response\n            if (isNumber(response.unread_count)) {\n                this._unreadCount = response.unread_count\n                this._widgetRef?.setUnreadCount(response.unread_count)\n\n                // If widget is open and there are unread messages, mark them as read\n                if (response.unread_count > 0 && this._isWidgetOpen()) {\n                    this._markMessagesAsRead()\n                }\n            }\n\n            if (response.messages.length > 0) {\n                this._widgetRef?.addMessages(response.messages)\n                // Update last message timestamp\n                const lastMessage = response.messages[response.messages.length - 1]\n                this._lastMessageTimestamp = lastMessage.created_at\n            }\n        } catch (error) {\n            logger.error('Failed to load messages', error)\n        }\n    }\n\n    /**\n     * Check if the widget is currently open\n     */\n    private _isWidgetOpen(): boolean {\n        return this._persistence.loadWidgetState() === 'open'\n    }\n\n    /**\n     * Poll for new messages\n     */\n    private _pollMessages = async (): Promise<void> => {\n        if (this._isPolling || !this._currentTicketId) {\n            return\n        }\n\n        this._isPolling = true\n        try {\n            await this._loadMessages()\n        } finally {\n            this._isPolling = false\n        }\n    }\n\n    /**\n     * Start polling for new messages\n     */\n    private _startPolling(): void {\n        if (this._pollIntervalId) {\n            return // Already polling\n        }\n\n        // Poll immediately\n        this._pollMessages()\n\n        // Set up interval\n        this._pollIntervalId = window?.setInterval(() => {\n            this._pollMessages()\n        }, POLL_INTERVAL_MS) as unknown as number\n\n        logger.info('Started polling for messages')\n    }\n\n    /**\n     * Stop polling for new messages\n     */\n    private _stopPolling(): void {\n        if (this._pollIntervalId) {\n            window?.clearInterval(this._pollIntervalId)\n            this._pollIntervalId = null\n            logger.info('Stopped polling for messages')\n        }\n    }\n\n    /**\n     * Setup listener for identify events to handle distinct_id changes\n     */\n    private _setupIdentifyListener(): void {\n        // Listen for captured events and detect $identify events\n        this._unsubscribeIdentifyListener = this._posthog.on('eventCaptured', (event: any) => {\n            if (event.event === '$identify') {\n                const newDistinctId = event.properties?.distinct_id\n                const oldDistinctId = event.properties?.$anon_distinct_id\n\n                if (oldDistinctId && newDistinctId && oldDistinctId !== newDistinctId) {\n                    logger.info('Detected identify event', { oldDistinctId, newDistinctId })\n                    this._handleDistinctIdChange(oldDistinctId, newDistinctId)\n                }\n            }\n        })\n    }\n\n    /**\n     * Handle distinct_id changes when user identifies.\n     * The user continues their conversation seamlessly - widget_session_id stays the same.\n     * No migration needed since tickets are keyed by widget_session_id, not distinct_id.\n     * Backend will update ticket.distinct_id for Person linking on the next message.\n     */\n    private _handleDistinctIdChange(oldDistinctId: string, newDistinctId: string): void {\n        // No migration needed - widget_session_id stays the same\n        // The user keeps access to their ticket because the widget_session_id hasn't changed\n        logger.info('User identified, conversation continues with same widget_session_id', {\n            ticketId: this._currentTicketId,\n            widgetSessionId: this._widgetSessionId,\n            oldDistinctId,\n            newDistinctId,\n        })\n\n        // Track the identity change\n        this._posthog.capture('$conversations_identity_changed', {\n            hadExistingTicket: !!this._currentTicketId,\n        })\n    }\n\n    /**\n     * Show the widget (render it to DOM).\n     * The widget respects its saved state (open/closed).\n     * Note: Domain restrictions still apply - widget won't render on disallowed domains.\n     */\n    show(): void {\n        // Check domain restrictions - don't render on disallowed domains\n        if (!this._isDomainAllowed) {\n            logger.warn('Cannot show widget: current domain is not allowed')\n            return\n        }\n\n        // If widget isn't rendered yet, render it now\n        if (!this._isWidgetRendered) {\n            this._initializeWidget()\n        }\n    }\n\n    /**\n     * Hide and remove the widget from the DOM.\n     * Conversation data is preserved - call show() to re-render.\n     */\n    hide(): void {\n        // Stop polling when widget is hidden (save resources)\n        this._stopPolling()\n\n        if (this._containerElement) {\n            render(null, this._containerElement)\n            this._containerElement.remove()\n            this._containerElement = null\n        }\n        this._widgetRef = null\n        this._isWidgetRendered = false\n\n        // Reset timestamp so show() will re-fetch all messages\n        this._lastMessageTimestamp = null\n    }\n\n    /**\n     * Check if the widget is currently visible (rendered in DOM)\n     */\n    isVisible(): boolean {\n        return this._isWidgetRendered\n    }\n\n    /** Get tickets list for the current widget session */\n    async getTickets(options?: GetTicketsOptions): Promise<GetTicketsResponse> {\n        const token = this._config.token\n\n        const queryParams: Record<string, string> = {\n            widget_session_id: this._widgetSessionId,\n            limit: String(options?.limit ?? 20),\n            offset: String(options?.offset ?? 0),\n        }\n\n        if (options?.status) {\n            queryParams.status = options.status\n        }\n\n        // eslint-disable-next-line compat/compat\n        return new Promise((resolve, reject) => {\n            this._posthog._send_request({\n                url: this._posthog.requestRouter.endpointFor(\n                    'api',\n                    `/api/conversations/v1/widget/tickets?${formDataToQuery(queryParams)}`\n                ),\n                method: 'GET',\n                headers: {\n                    'X-Conversations-Token': token,\n                },\n                callback: (response) => {\n                    if (response.statusCode === 429) {\n                        reject(new Error('Too many requests. Please wait before trying again.'))\n                        return\n                    }\n\n                    if (response.statusCode !== 200) {\n                        const errorMsg = response.json?.detail || response.json?.message || 'Failed to fetch tickets'\n                        logger.error('Failed to fetch tickets', { status: response.statusCode })\n                        reject(new Error(errorMsg))\n                        return\n                    }\n\n                    if (!response.json) {\n                        reject(new Error('Invalid response from server'))\n                        return\n                    }\n\n                    const data = response.json as GetTicketsResponse\n                    resolve(data)\n                },\n            })\n        })\n    }\n\n    /**\n     * Get the current active ticket ID\n     * Returns null if no conversation has been started yet\n     */\n    getCurrentTicketId(): string | null {\n        return this._currentTicketId\n    }\n\n    /**\n     * Get the widget session ID (persistent browser identifier)\n     * This ID is used for access control and stays the same across page loads\n     */\n    getWidgetSessionId(): string {\n        return this._widgetSessionId\n    }\n\n    /**\n     * Clean up the widget\n     */\n    destroy(): void {\n        this._stopPolling()\n\n        // Unsubscribe from identify events\n        if (this._unsubscribeIdentifyListener) {\n            this._unsubscribeIdentifyListener()\n            this._unsubscribeIdentifyListener = null\n        }\n\n        if (this._containerElement) {\n            render(null, this._containerElement)\n            this._containerElement.remove()\n            this._containerElement = null\n        }\n\n        this._widgetRef = null\n        logger.info('Widget destroyed')\n    }\n\n    /**\n     * Reset all conversation data and destroy the widget.\n     * Called on posthog.reset() to start fresh.\n     */\n    reset(): void {\n        // Clear all persisted conversation data\n        this._persistence.clearAll()\n\n        // Reset local state\n        this._currentTicketId = null\n        this._lastMessageTimestamp = null\n        this._unreadCount = 0\n\n        // Destroy the widget\n        this.destroy()\n\n        logger.info('Conversations reset')\n    }\n\n    /**\n     * Render the widget to the DOM\n     */\n    private _renderWidget(initialState: ConversationsWidgetState, initialUserTraits: UserProvidedTraits | null): void {\n        if (!document) {\n            logger.info('Conversations widget not rendered: Document not available')\n            return\n        }\n\n        // Create container if it doesn't exist\n        let container = document.getElementById(WIDGET_CONTAINER_ID) as HTMLDivElement\n        if (!container) {\n            if (!document.body) {\n                logger.info('Conversations widget not rendered: Document body not available yet')\n                return\n            }\n            container = document.createElement('div')\n            container.id = WIDGET_CONTAINER_ID\n            document.body.appendChild(container)\n        }\n        this._containerElement = container\n\n        // Render widget with ref\n        render(\n            <ConversationsWidget\n                ref={(ref: ConversationsWidget | null) => {\n                    this._widgetRef = ref\n                }}\n                config={this._config}\n                initialState={initialState}\n                initialUserTraits={initialUserTraits}\n                onSendMessage={this._handleSendMessage}\n                onStateChange={this._handleStateChange}\n                onIdentify={this._handleIdentify}\n            />,\n            container\n        )\n    }\n}\n\n/**\n * Initialize the conversations widget\n * This is the entry point called from the lazy-loaded bundle\n */\nexport function initConversations(config: ConversationsRemoteConfig, posthog: PostHog): ConversationsManager {\n    logger.info('initConversations called', { hasConfig: !!config, hasPosthog: !!posthog })\n    return new ConversationsManager(config, posthog)\n}\n","import { initConversations } from '../extensions/conversations/external'\nimport { assignableWindow } from '../utils/globals'\n\nassignableWindow.__PosthogExtensions__ = assignableWindow.__PosthogExtensions__ || {}\nassignableWindow.__PosthogExtensions__.initConversations = initConversations\n\nexport default initConversations\n"],"names":["p","v","y","nativeIsArray","Array","isArray","ObjProto","Object","prototype","type_utils_hasOwnProperty","hasOwnProperty","type_utils_toString","toString","obj","call","isUndefined","x","isNumber","win","window","undefined","global","globalThis","self","File","nativeForEach","forEach","navigator","document","location","fetch","XMLHttpRequest","AbortController","userAgent","assignableWindow","_createLogger","prefix","_temp","debugEnabled","logger","_log","level","POSTHOG_DEBUG","console","consoleLog","_len","arguments","length","args","_key","info","_len2","_key2","warn","_len3","_key3","error","_len4","_key4","critical","_len5","_key5","uninitializedWarning","methodName","createLogger","additionalPrefix","options","Math","trunc","ceil","floor","Number","isInteger","value","isFinite","DIGITS","UUID","constructor","bytes","this","TypeError","fromFieldsV7","unixTsMs","randA","randBHi","randBLo","RangeError","Uint8Array","pow","text","i","charAt","Error","clone","slice","equals","other","compareTo","diff","sign","V7Generator","_timestamp","_counter","_random","DefaultRandom","generate","generateOrAbort","valueAfterReset","ts","Date","now","_resetCounter","nextUint32","defaultGenerator","getRandomValues","buffer","UUIDV7_DENY_WEAK_RNG","random","crypto","_buffer","Uint32Array","_cursor","Infinity","uuidv7","uuidv7obj","CONVERSATIONS_WIDGET_SESSION_ID","CONVERSATIONS_TICKET_ID","CONVERSATIONS_WIDGET_STATE","CONVERSATIONS_USER_TRAITS","ConversationsPersistence","_posthog","_cachedWidgetSessionId","_isPersistenceAvailable","_this$_posthog$persis","_this$_posthog$persis2","persistence","isDisabled","getOrCreateWidgetSessionId","sessionId","_this$_posthog$persis3","_this$_posthog$persis4","get_property","register","clearWidgetSessionId","_this$_posthog$persis5","unregister","saveTicketId","ticketId","_this$_posthog$persis6","loadTicketId","_this$_posthog$persis7","clearTicketId","_this$_posthog$persis8","saveWidgetState","state","_this$_posthog$persis9","loadWidgetState","_this$_posthog$persis0","saveUserTraits","traits","_this$_posthog$persis1","hasName","name","hasEmail","email","loadUserTraits","_this$_posthog$persis10","clearUserTraits","_this$_posthog$persis11","clearAll","_this$_posthog$persis12","_this$_posthog$persis13","_this$_posthog$persis14","getStyles","primaryColor","widget","position","bottom","right","zIndex","fontFamily","buttonContainer","button","width","height","borderRadius","background","color","border","cursor","boxShadow","display","alignItems","justifyContent","transition","unreadBadge","top","minWidth","fontSize","fontWeight","padding","boxSizing","flexDirection","overflow","windowOpen","maxHeight","header","flexShrink","headerTitle","headerActions","gap","headerButton","lineHeight","opacity","messages","flex","overflowY","message","maxWidth","animation","messageCustomer","alignSelf","messageAgent","messageAuthor","marginBottom","messageContent","wordWrap","whiteSpace","messageContentCustomer","borderBottomRightRadius","messageContentAgent","borderBottomLeftRadius","messageTime","marginTop","borderTop","borderBottom","textAlign","inputContainer","input","resize","outline","fieldSizing","sendButton","identificationForm","formTitle","formDescription","formField","formLabel","formInput","formInputError","borderColor","formError","formSubmitButton","formOptional","OpenChatButton","_ref","handleToggleOpen","unreadCount","styles","displayCount","_jsx","style","children","_jsxs","onClick","onMouseEnter","e","currentTarget","transform","onMouseLeave","viewBox","fill","xmlns","d","SendMessageButton","inputValue","isLoading","handleSendMessage","_extends","trim","disabled","stroke","strokeWidth","strokeLinejoin","CloseChatButton","handleClose","ConversationsWidget","Component","props","_this","super","_messagesEndRef","_inputRef","_handleToggleOpen","setState","prevState","_handleClose","_handleInputChange","target","_handleKeyPress","key","shiftKey","preventDefault","_handleSendMessage","_handleFormNameChange","formName","_handleFormEmailChange","formEmail","formEmailError","_handleFormSubmit","config","onIdentify","requireEmail","_validateEmail","userTraits","showIdentificationForm","_asyncToGenerator","trimmedMessage","userMessage","id","content","author_type","author_name","created_at","toISOString","is_private","onSendMessage","filter","m","initialUserTraits","needsIdentification","_needsIdentification","initialState","componentDidMount","greetingText","_addGreetingMessage","componentDidUpdate","_prevProps","_scrollToBottom","onStateChange","_focusInput","greetingMessage","scrollIntoView","behavior","focus","test","_formatTime","isoString","date","diffMs","getTime","diffMins","toLocaleDateString","addMessages","existingIds","Set","map","newMessages","has","show","hide","close","getUserTraits","setUnreadCount","count","_renderIdentificationForm","title","identificationFormTitle","description","identificationFormDescription","showNameField","collectName","onSubmit","type","onInput","placeholder","autoComplete","_renderMessage","isCustomer","messageStyle","contentStyle","render","placeholderText","windowStyle","_Fragment","ref","el","onKeyPress","rows","breaker","each","iterator","thisArg","isNull","isNullish","l","eachArray","FormData","isFormData","pair","entries","formDataToQuery","formdata","arg_separator","use_val","use_key","tph_arr","val","encodeURIComponent","isFile","join","WIDGET_CONTAINER_ID","ConversationsManager","_widgetRef","_containerElement","_currentTicketId","_pollIntervalId","_lastMessageTimestamp","_isPolling","_unsubscribeIdentifyListener","_unreadCount","_isWidgetRendered","_handleIdentify","_persistence","capture","_this$_widgetRef","sendMessage","setTimeout","_pollMessages","_x","apply","_handleStateChange","_markMessagesAsRead","_loadMessages","_config","_widgetSessionId","_isWidgetEnabled","widgetEnabled","_isDomainAllowed","domains","_window$location","currentHostname","hostname","some","domain","allowedHostname","replace","split","extractHostname","startsWith","pattern","endsWith","isCurrentDomainAllowed","widgetSessionId","isWidgetEnabled","isDomainAllowed","_initialize","newTicket","_this2","isNewTicket","token","Promise","resolve","reject","_this2$_posthog$persi","distinctId","get_distinct_id","personProperties","$name","$email","payload","widget_session_id","distinct_id","ticket_id","_window$location2","capturedSessionId","get_session_id","session_id","replayUrl","get_session_replay_url","withTimestamp","timestampLookBack","currentUrl","href","session_context","session_replay_url","current_url","_send_request","url","requestRouter","endpointFor","method","data","headers","callback","response","statusCode","_response$json","_response$json2","errorMsg","json","detail","status","forced","messageLength","_switchToTicketIfNeeded","getMessages","after","_this3","targetTicketId","queryParams","limit","_response$json3","_response$json4","markAsRead","_this4","_response$json5","_response$json6","hasExistingTicket","domainAllowed","_initializeWidget","_setupIdentifyListener","_getInitialUserTraits","_renderWidget","hasUserTraits","_startPolling","posthogName","posthogEmail","savedTraits","_this5","_this5$_widgetRef","unread_count","_this6","_this6$_widgetRef","_isWidgetOpen","_this6$_widgetRef2","lastMessage","setInterval","_stopPolling","clearInterval","on","event","_event$properties","_event$properties2","newDistinctId","properties","oldDistinctId","$anon_distinct_id","_handleDistinctIdChange","hadExistingTicket","remove","isVisible","getTickets","_this7","_options$limit","_options$offset","String","offset","_response$json7","_response$json8","getCurrentTicketId","getWidgetSessionId","destroy","reset","container","getElementById","body","createElement","appendChild","initConversations","posthog","hasConfig","hasPosthog","__PosthogExtensions__"],"mappings":"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","x_google_ignoreList":[0]}