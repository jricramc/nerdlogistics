!function(){"use strict";function e(e,t,i,n,r,o,s){try{var l=e[o](s),a=l.value}catch(e){return void i(e)}l.done?t(a):Promise.resolve(a).then(n,r)}function t(t){return function(){var i=this,n=arguments;return new Promise((function(r,o){var s=t.apply(i,n);function l(t){e(s,r,o,l,a,"next",t)}function a(t){e(s,r,o,l,a,"throw",t)}l(void 0)}))}}function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)({}).hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},i.apply(null,arguments)}var n,r,o,s,l,a,u,d,h,c,f,v={},p=[],g=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,m=Array.isArray;function w(e,t){for(var i in t)e[i]=t[i];return e}function y(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function b(e,t,i,n,s){var l={type:e,props:t,key:i,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==s?++o:s,__i:-1,__u:0};return null==s&&null!=r.vnode&&r.vnode(l),l}function x(e){return e.children}function _(e,t){this.props=e,this.context=t}function k(e,t){if(null==t)return e.__?k(e.__,e.__i+1):null;for(var i;t<e.__k.length;t++)if(null!=(i=e.__k[t])&&null!=i.__e)return i.__e;return"function"==typeof e.type?k(e):null}function I(e){var t,i;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(i=e.__k[t])&&null!=i.__e){e.__e=e.__c.base=i.__e;break}return I(e)}}function C(e){(!e.__d&&(e.__d=!0)&&s.push(e)&&!$.__r++||l!=r.debounceRendering)&&((l=r.debounceRendering)||a)($)}function $(){for(var e,t,i,n,o,l,a,d=1;s.length;)s.length>d&&s.sort(u),e=s.shift(),d=s.length,e.__d&&(i=void 0,n=void 0,o=(n=(t=e).__v).__e,l=[],a=[],t.__P&&((i=w({},n)).__v=n.__v+1,r.vnode&&r.vnode(i),A(t.__P,i,n,t.__n,t.__P.namespaceURI,32&n.__u?[o]:null,l,null==o?k(n):o,!!(32&n.__u),a),i.__v=n.__v,i.__.__k[i.__i]=i,W(l,i,a),n.__e=n.__=null,i.__e!=o&&I(i)));$.__r=0}function S(e,t,i,n,r,o,s,l,a,u,d){var h,c,f,g,m,w,y,b=n&&n.__k||p,x=t.length;for(a=E(i,t,b,a,x),h=0;h<x;h++)null!=(f=i.__k[h])&&(c=-1==f.__i?v:b[f.__i]||v,f.__i=h,w=A(e,f,c,r,o,s,l,a,u,d),g=f.__e,f.ref&&c.ref!=f.ref&&(c.ref&&U(c.ref,null,f),d.push(f.ref,f.__c||g,f)),null==m&&null!=g&&(m=g),(y=!!(4&f.__u))||c.__k===f.__k?a=T(f,a,e,y):"function"==typeof f.type&&void 0!==w?a=w:g&&(a=g.nextSibling),f.__u&=-7);return i.__e=m,a}function E(e,t,i,n,r){var o,s,l,a,u,d=i.length,h=d,c=0;for(e.__k=new Array(r),o=0;o<r;o++)null!=(s=t[o])&&"boolean"!=typeof s&&"function"!=typeof s?("string"==typeof s||"number"==typeof s||"bigint"==typeof s||s.constructor==String?s=e.__k[o]=b(null,s,null,null,null):m(s)?s=e.__k[o]=b(x,{children:s},null,null,null):void 0===s.constructor&&s.__b>0?s=e.__k[o]=b(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):e.__k[o]=s,a=o+c,s.__=e,s.__b=e.__b+1,l=null,-1!=(u=s.__i=M(s,i,a,h))&&(h--,(l=i[u])&&(l.__u|=2)),null==l||null==l.__v?(-1==u&&(r>d?c--:r<d&&c++),"function"!=typeof s.type&&(s.__u|=4)):u!=a&&(u==a-1?c--:u==a+1?c++:(u>a?c--:c++,s.__u|=4))):e.__k[o]=null;if(h)for(o=0;o<d;o++)null!=(l=i[o])&&0==(2&l.__u)&&(l.__e==n&&(n=k(l)),R(l,l));return n}function T(e,t,i,n){var r,o;if("function"==typeof e.type){for(r=e.__k,o=0;r&&o<r.length;o++)r[o]&&(r[o].__=e,t=T(r[o],t,i,n));return t}e.__e!=t&&(n&&(t&&e.type&&!t.parentNode&&(t=k(e)),i.insertBefore(e.__e,t||null)),t=e.__e);do{t=t&&t.nextSibling}while(null!=t&&8==t.nodeType);return t}function M(e,t,i,n){var r,o,s,l=e.key,a=e.type,u=t[i],d=null!=u&&0==(2&u.__u);if(null===u&&null==l||d&&l==u.key&&a==u.type)return i;if(n>(d?1:0))for(r=i-1,o=i+1;r>=0||o<t.length;)if(null!=(u=t[s=r>=0?r--:o++])&&0==(2&u.__u)&&l==u.key&&a==u.type)return s;return-1}function F(e,t,i){"-"==t[0]?e.setProperty(t,null==i?"":i):e[t]=null==i?"":"number"!=typeof i||g.test(t)?i:i+"px"}function D(e,t,i,n,r){var o,s;e:if("style"==t)if("string"==typeof i)e.style.cssText=i;else{if("string"==typeof n&&(e.style.cssText=n=""),n)for(t in n)i&&t in i||F(e.style,t,"");if(i)for(t in i)n&&i[t]==n[t]||F(e.style,t,i[t])}else if("o"==t[0]&&"n"==t[1])o=t!=(t=t.replace(d,"$1")),s=t.toLowerCase(),t=s in e||"onFocusOut"==t||"onFocusIn"==t?s.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=i,i?n?i.u=n.u:(i.u=h,e.addEventListener(t,o?f:c,o)):e.removeEventListener(t,o?f:c,o);else{if("http://www.w3.org/2000/svg"==r)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=t&&"height"!=t&&"href"!=t&&"list"!=t&&"form"!=t&&"tabIndex"!=t&&"download"!=t&&"rowSpan"!=t&&"colSpan"!=t&&"role"!=t&&"popover"!=t&&t in e)try{e[t]=null==i?"":i;break e}catch(e){}"function"==typeof i||(null==i||!1===i&&"-"!=t[4]?e.removeAttribute(t):e.setAttribute(t,"popover"==t&&1==i?"":i))}}function P(e){return function(t){if(this.l){var i=this.l[t.type+e];if(null==t.t)t.t=h++;else if(t.t<i.u)return;return i(r.event?r.event(t):t)}}}function A(e,t,i,n,o,s,l,a,u,d){var h,c,f,v,p,g,b,k,I,C,E,$,T,M,F,D,P,A=t.type;if(void 0!==t.constructor)return null;128&i.__u&&(u=!!(32&i.__u),s=[a=t.__e=i.__e]),(h=r.__b)&&h(t);e:if("function"==typeof A)try{if(k=t.props,I="prototype"in A&&A.prototype.render,C=(h=A.contextType)&&n[h.__c],E=h?C?C.props.value:h.__:n,i.__c?b=(c=t.__c=i.__c).__=c.__E:(I?t.__c=c=new A(k,E):(t.__c=c=new _(k,E),c.constructor=A,c.render=B),C&&C.sub(c),c.state||(c.state={}),c.__n=n,f=c.__d=!0,c.__h=[],c._sb=[]),I&&null==c.__s&&(c.__s=c.state),I&&null!=A.getDerivedStateFromProps&&(c.__s==c.state&&(c.__s=w({},c.__s)),w(c.__s,A.getDerivedStateFromProps(k,c.__s))),v=c.props,p=c.state,c.__v=t,f)I&&null==A.getDerivedStateFromProps&&null!=c.componentWillMount&&c.componentWillMount(),I&&null!=c.componentDidMount&&c.__h.push(c.componentDidMount);else{if(I&&null==A.getDerivedStateFromProps&&k!==v&&null!=c.componentWillReceiveProps&&c.componentWillReceiveProps(k,E),t.__v==i.__v||!c.__e&&null!=c.shouldComponentUpdate&&!1===c.shouldComponentUpdate(k,c.__s,E)){for(t.__v!=i.__v&&(c.props=k,c.state=c.__s,c.__d=!1),t.__e=i.__e,t.__k=i.__k,t.__k.some((function(e){e&&(e.__=t)})),$=0;$<c._sb.length;$++)c.__h.push(c._sb[$]);c._sb=[],c.__h.length&&l.push(c);break e}null!=c.componentWillUpdate&&c.componentWillUpdate(k,c.__s,E),I&&null!=c.componentDidUpdate&&c.__h.push((function(){c.componentDidUpdate(v,p,g)}))}if(c.context=E,c.props=k,c.__P=e,c.__e=!1,T=r.__r,M=0,I){for(c.state=c.__s,c.__d=!1,T&&T(t),h=c.render(c.props,c.state,c.context),F=0;F<c._sb.length;F++)c.__h.push(c._sb[F]);c._sb=[]}else do{c.__d=!1,T&&T(t),h=c.render(c.props,c.state,c.context),c.state=c.__s}while(c.__d&&++M<25);c.state=c.__s,null!=c.getChildContext&&(n=w(w({},n),c.getChildContext())),I&&!f&&null!=c.getSnapshotBeforeUpdate&&(g=c.getSnapshotBeforeUpdate(v,p)),D=h,null!=h&&h.type===x&&null==h.key&&(D=z(h.props.children)),a=S(e,m(D)?D:[D],t,i,n,o,s,l,a,u,d),c.base=t.__e,t.__u&=-161,c.__h.length&&l.push(c),b&&(c.__E=c.__=null)}catch(e){if(t.__v=null,u||null!=s)if(e.then){for(t.__u|=u?160:128;a&&8==a.nodeType&&a.nextSibling;)a=a.nextSibling;s[s.indexOf(a)]=null,t.__e=a}else{for(P=s.length;P--;)y(s[P]);L(t)}else t.__e=i.__e,t.__k=i.__k,e.then||L(t);r.__e(e,t,i)}else null==s&&t.__v==i.__v?(t.__k=i.__k,t.__e=i.__e):a=t.__e=N(i.__e,t,i,n,o,s,l,u,d);return(h=r.diffed)&&h(t),128&t.__u?void 0:a}function L(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(L)}function W(e,t,i){for(var n=0;n<i.length;n++)U(i[n],i[++n],i[++n]);r.__c&&r.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){r.__e(e,t.__v)}}))}function z(e){return"object"!=typeof e||null==e||e.__b&&e.__b>0?e:m(e)?e.map(z):w({},e)}function N(e,t,i,o,s,l,a,u,d){var h,c,f,p,g,w,b,x=i.props||v,_=t.props,I=t.type;if("svg"==I?s="http://www.w3.org/2000/svg":"math"==I?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),null!=l)for(h=0;h<l.length;h++)if((g=l[h])&&"setAttribute"in g==!!I&&(I?g.localName==I:3==g.nodeType)){e=g,l[h]=null;break}if(null==e){if(null==I)return document.createTextNode(_);e=document.createElementNS(s,I,_.is&&_),u&&(r.__m&&r.__m(t,l),u=!1),l=null}if(null==I)x===_||u&&e.data==_||(e.data=_);else{if(l=l&&n.call(e.childNodes),!u&&null!=l)for(x={},h=0;h<e.attributes.length;h++)x[(g=e.attributes[h]).name]=g.value;for(h in x)if(g=x[h],"children"==h);else if("dangerouslySetInnerHTML"==h)f=g;else if(!(h in _)){if("value"==h&&"defaultValue"in _||"checked"==h&&"defaultChecked"in _)continue;D(e,h,null,g,s)}for(h in _)g=_[h],"children"==h?p=g:"dangerouslySetInnerHTML"==h?c=g:"value"==h?w=g:"checked"==h?b=g:u&&"function"!=typeof g||x[h]===g||D(e,h,g,x[h],s);if(c)u||f&&(c.__html==f.__html||c.__html==e.innerHTML)||(e.innerHTML=c.__html),t.__k=[];else if(f&&(e.innerHTML=""),S("template"==t.type?e.content:e,m(p)?p:[p],t,i,o,"foreignObject"==I?"http://www.w3.org/1999/xhtml":s,l,a,l?l[0]:i.__k&&k(i,0),u,d),null!=l)for(h=l.length;h--;)y(l[h]);u||(h="value","progress"==I&&null==w?e.removeAttribute("value"):null!=w&&(w!==e[h]||"progress"==I&&!w||"option"==I&&w!=x[h])&&D(e,h,w,x[h],s),h="checked",null!=b&&b!=e[h]&&D(e,h,b,x[h],s))}return e}function U(e,t,i){try{if("function"==typeof e){var n="function"==typeof e.__u;n&&e.__u(),n&&null==t||(e.__u=e(t))}else e.current=t}catch(e){r.__e(e,i)}}function R(e,t,i){var n,o;if(r.unmount&&r.unmount(e),(n=e.ref)&&(n.current&&n.current!=e.__e||U(n,null,t)),null!=(n=e.__c)){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(e){r.__e(e,t)}n.base=n.__P=null}if(n=e.__k)for(o=0;o<n.length;o++)n[o]&&R(n[o],t,i||"function"!=typeof e.type);i||y(e.__e),e.__c=e.__=e.__e=void 0}function B(e,t,i){return this.constructor(e,i)}function O(e,t,i){var o,s,l;t==document&&(t=document.documentElement),r.__&&r.__(e,t),o=!1?null:t.__k,s=[],l=[],A(t,e=t.__k=function(e,t,i){var r,o,s,l={};for(s in t)"key"==s?r=t[s]:"ref"==s?o=t[s]:l[s]=t[s];if(arguments.length>2&&(l.children=arguments.length>3?n.call(arguments,2):i),"function"==typeof e&&null!=e.defaultProps)for(s in e.defaultProps)void 0===l[s]&&(l[s]=e.defaultProps[s]);return b(e,l,r,o,null)}(x,null,[e]),o||v,v,t.namespaceURI,o?null:t.firstChild?n.call(t.childNodes):null,s,o?o.__e:t.firstChild,false,l),W(s,e,l)}n=p.slice,r={__e:function(e,t,i,n){for(var r,o,s;t=t.__;)if((r=t.__c)&&!r.__)try{if((o=r.constructor)&&null!=o.getDerivedStateFromError&&(r.setState(o.getDerivedStateFromError(e)),s=r.__d),null!=r.componentDidCatch&&(r.componentDidCatch(e,n||{}),s=r.__d),s)return r.__E=r}catch(t){e=t}throw e}},o=0,_.prototype.setState=function(e,t){var i;i=null!=this.__s&&this.__s!=this.state?this.__s:this.__s=w({},this.state),"function"==typeof e&&(e=e(w({},i),this.props)),e&&w(i,e),null!=e&&this.__v&&(t&&this._sb.push(t),C(this))},_.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),C(this))},_.prototype.render=x,s=[],a="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,u=function(e,t){return e.__v.__b-t.__v.__b},$.__r=0,d=/(PointerCapture)$|Capture$/i,h=0,c=P(!1),f=P(!0);var H=Array.isArray,j=Object.prototype,V=j.hasOwnProperty,Y=j.toString,q=H||function(e){return"[object Array]"===Y.call(e)},G=e=>void 0===e,X=e=>"[object Number]"==Y.call(e)&&e==e,K="undefined"!=typeof window?window:void 0,Z="undefined"!=typeof globalThis?globalThis:K;"undefined"==typeof self&&(Z.self=Z),"undefined"==typeof File&&(Z.File=function(){});var J=Array.prototype.forEach,Q=null==Z?void 0:Z.navigator,ee=null==Z?void 0:Z.document;null==Z||Z.location,null==Z||Z.fetch,null!=Z&&Z.XMLHttpRequest&&"withCredentials"in new Z.XMLHttpRequest&&Z.XMLHttpRequest,null==Z||Z.AbortController,null==Q||Q.userAgent;var te=null!=K?K:{},ie=function(e,t){var{debugEnabled:i}=void 0===t?{}:t,n={i:function(t){if(K&&(te.POSTHOG_DEBUG||i)&&!G(K.console)&&K.console){for(var n=("__rrweb_original__"in K.console[t]?K.console[t].__rrweb_original__:K.console[t]),r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];n(e,...o)}},info:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.i("log",...t)},warn:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.i("warn",...t)},error:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.i("error",...t)},critical:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];console.error(e,...i)},uninitializedWarning:e=>{n.error("You must initialize PostHog before calling "+e)},createLogger:(t,i)=>ie(e+" "+t,i)};return n},ne=ie("[PostHog.js]").createLogger;Math.trunc||(Math.trunc=function(e){return e<0?Math.ceil(e):Math.floor(e)}),Number.isInteger||(Number.isInteger=function(e){return X(e)&&isFinite(e)&&Math.floor(e)===e});var re="0123456789abcdef";class oe{constructor(e){if(this.bytes=e,16!==e.length)throw new TypeError("not 128-bit length")}static fromFieldsV7(e,t,i,n){if(!Number.isInteger(e)||!Number.isInteger(t)||!Number.isInteger(i)||!Number.isInteger(n)||e<0||t<0||i<0||n<0||e>0xffffffffffff||t>4095||i>1073741823||n>4294967295)throw new RangeError("invalid field value");var r=new Uint8Array(16);return r[0]=e/Math.pow(2,40),r[1]=e/Math.pow(2,32),r[2]=e/Math.pow(2,24),r[3]=e/Math.pow(2,16),r[4]=e/Math.pow(2,8),r[5]=e,r[6]=112|t>>>8,r[7]=t,r[8]=128|i>>>24,r[9]=i>>>16,r[10]=i>>>8,r[11]=i,r[12]=n>>>24,r[13]=n>>>16,r[14]=n>>>8,r[15]=n,new oe(r)}toString(){for(var e="",t=0;t<this.bytes.length;t++)e=e+re.charAt(this.bytes[t]>>>4)+re.charAt(15&this.bytes[t]),3!==t&&5!==t&&7!==t&&9!==t||(e+="-");if(36!==e.length)throw new Error("Invalid UUIDv7 was generated");return e}clone(){return new oe(this.bytes.slice(0))}equals(e){return 0===this.compareTo(e)}compareTo(e){for(var t=0;t<16;t++){var i=this.bytes[t]-e.bytes[t];if(0!==i)return Math.sign(i)}return 0}}class se{constructor(){this.o=0,this.h=0,this.v=new ue}generate(){var e=this.generateOrAbort();if(G(e)){this.o=0;var t=this.generateOrAbort();if(G(t))throw new Error("Could not generate UUID after timestamp reset");return t}return e}generateOrAbort(){var e=Date.now();if(e>this.o)this.o=e,this.p();else{if(!(e+1e4>this.o))return;this.h++,this.h>4398046511103&&(this.o++,this.p())}return oe.fromFieldsV7(this.o,Math.trunc(this.h/Math.pow(2,30)),this.h&Math.pow(2,30)-1,this.v.nextUint32())}p(){this.h=1024*this.v.nextUint32()+(1023&this.v.nextUint32())}}var le,ae=e=>{if("undefined"!=typeof UUIDV7_DENY_WEAK_RNG&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");for(var t=0;t<e.length;t++)e[t]=65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random());return e};K&&!G(K.crypto)&&crypto.getRandomValues&&(ae=e=>crypto.getRandomValues(e));class ue{constructor(){this.m=new Uint32Array(8),this.k=1/0}nextUint32(){return this.k>=this.m.length&&(ae(this.m),this.k=0),this.m[this.k++]}}var de=()=>he().toString(),he=()=>(le||(le=new se)).generate(),ce=ne("[ConversationsPersistence]"),fe="$conversations_widget_session_id",ve="$conversations_ticket_id",pe="$conversations_widget_state",ge="$conversations_user_traits";class me{constructor(e){this.I=null,this._posthog=e}C(){var e,t;return!(!this._posthog.persistence||null!=(e=(t=this._posthog.persistence).isDisabled)&&e.call(t))}getOrCreateWidgetSessionId(){if(this.I)return this.I;if(!this.C()){var e=de();return ce.warn("Persistence not available, widget_session_id will not persist",{sessionId:e}),e}try{var t,i,n=null==(t=this._posthog.persistence)?void 0:t.get_property(fe);if(!n)n=de(),null==(i=this._posthog.persistence)||i.register({[fe]:n});return this.I=n,n}catch(e){return ce.error("Failed to get/create widget_session_id",e),de()}}clearWidgetSessionId(){if(this.I=null,this.C())try{var e;null==(e=this._posthog.persistence)||e.unregister(fe),ce.info("Cleared widget_session_id")}catch(e){ce.error("Failed to clear widget_session_id",e)}}saveTicketId(e){if(this.C())try{var t;null==(t=this._posthog.persistence)||t.register({[ve]:e}),ce.info("Saved ticket ID",{ticketId:e})}catch(e){ce.error("Failed to save ticket ID",e)}else ce.warn("Persistence not available")}loadTicketId(){if(!this.C())return ce.warn("Persistence not available"),null;try{var e,t=null==(e=this._posthog.persistence)?void 0:e.get_property(ve);return t&&ce.info("Loaded ticket ID",{ticketId:t}),t||null}catch(e){return ce.error("Failed to load ticket ID",e),null}}clearTicketId(){if(this.C())try{var e;null==(e=this._posthog.persistence)||e.unregister(ve),ce.info("Cleared ticket ID")}catch(e){ce.error("Failed to clear ticket ID",e)}else ce.warn("Persistence not available")}saveWidgetState(e){if(this.C())try{var t;null==(t=this._posthog.persistence)||t.register({[pe]:e})}catch(e){ce.error("Failed to save widget state",e)}}loadWidgetState(){if(!this.C())return null;try{var e,t=null==(e=this._posthog.persistence)?void 0:e.get_property(pe);return"open"===t||"closed"===t?t:null}catch(e){return ce.error("Failed to load widget state",e),null}}saveUserTraits(e){if(this.C())try{var t;null==(t=this._posthog.persistence)||t.register({[ge]:e}),ce.info("Saved user traits",{hasName:!!e.name,hasEmail:!!e.email})}catch(e){ce.error("Failed to save user traits",e)}else ce.warn("Persistence not available")}loadUserTraits(){if(!this.C())return null;try{var e,t=null==(e=this._posthog.persistence)?void 0:e.get_property(ge);return t?(ce.info("Loaded user traits",{hasName:!!t.name,hasEmail:!!t.email}),t):null}catch(e){return ce.error("Failed to load user traits",e),null}}clearUserTraits(){if(this.C())try{var e;null==(e=this._posthog.persistence)||e.unregister(ge),ce.info("Cleared user traits")}catch(e){ce.error("Failed to clear user traits",e)}}clearAll(){if(this.C())try{var e,t,i;null==(e=this._posthog.persistence)||e.unregister(pe),null==(t=this._posthog.persistence)||t.unregister(ge),null==(i=this._posthog.persistence)||i.unregister(ve),this.clearWidgetSessionId(),ce.info("Cleared all conversation data")}catch(e){ce.error("Failed to clear conversation data",e)}}}var we=e=>({widget:{position:"fixed",bottom:"20px",right:"20px",zIndex:2147483647,fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Roboto", Helvetica, Arial, sans-serif'},buttonContainer:{position:"relative"},button:{width:"50px",height:"50px",borderRadius:"50%",background:e,color:"white",border:"none",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",display:"flex",alignItems:"center",justifyContent:"center",transition:"transform 0.2s ease-out, box-shadow 0.2s ease-out"},unreadBadge:{position:"absolute",top:"-4px",right:"-4px",minWidth:"20px",height:"20px",borderRadius:"10px",background:"#ef4444",color:"white",fontSize:"11px",fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center",padding:"0 5px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)",border:"2px solid white",boxSizing:"border-box"},window:{position:"absolute",bottom:0,right:0,background:"white",borderRadius:"10px",boxShadow:"0 10px 25px -3px rgba(0,0,0,0.12), 0 4px 12px -2px rgba(0,0,0,0.10)",display:"flex",flexDirection:"column",overflow:"hidden",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",border:"none"},windowOpen:{width:"400px",height:"600px",maxHeight:"calc(100vh - 100px)"},header:{background:e,color:"white",padding:"8px 12px",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},headerTitle:{fontWeight:500,fontSize:"14px"},headerActions:{display:"flex",gap:"4px"},headerButton:{background:"transparent",border:"none",color:"white",cursor:"pointer",padding:"6px 8px",fontSize:"16px",lineHeight:1,borderRadius:"4px",transition:"background 0.2s ease-out",opacity:.9},messages:{flex:1,overflowY:"auto",padding:"14px",display:"flex",flexDirection:"column",gap:"8px",background:"white"},message:{display:"flex",flexDirection:"column",maxWidth:"85%",animation:"fadeIn 0.2s ease-out"},messageCustomer:{alignSelf:"flex-end",alignItems:"flex-end"},messageAgent:{alignSelf:"flex-start",alignItems:"flex-start"},messageAuthor:{fontSize:"10px",color:"#939393",marginBottom:"4px",fontWeight:500},messageContent:{padding:"8px 12px",borderRadius:"8px",fontSize:"12px",lineHeight:1.5,wordWrap:"break-word",whiteSpace:"pre-wrap"},messageContentCustomer:{background:e,color:"white",borderBottomRightRadius:"2px"},messageContentAgent:{background:"white",color:"#020617",border:"1.5px solid #dcdcdc",borderBottomLeftRadius:"2px"},messageTime:{fontSize:"10px",color:"#939393",marginTop:"4px",opacity:.8},error:{padding:"10px 16px",background:"#fee2e2",color:"#991b1b",fontSize:"13px",borderTop:"1px solid #fecaca",borderBottom:"1px solid #fecaca",textAlign:"center",fontWeight:500},inputContainer:{padding:"8px 12px",background:"white",borderTop:"1px solid #dcdcdc",display:"flex",gap:"8px",alignItems:"center",flexShrink:0},input:{flex:1,maxHeight:"120px",fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:1.5,color:"#020617",background:"white",border:"none",outline:"none",transition:"border-color 0.2s ease-out, box-shadow 0.2s ease-out",display:"flex",alignItems:"center",fieldSizing:"content"},sendButton:{width:"33px",height:"33px",borderRadius:"10px",background:e,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease-out",boxShadow:"0 2px 0 rgba(0, 0, 0, 0.045)",fontWeight:700,flexShrink:0},identificationForm:{flex:1,display:"flex",flexDirection:"column",padding:"24px",background:"#eeeded",overflowY:"auto"},formTitle:{fontSize:"18px",fontWeight:600,color:"#020617",marginBottom:"8px"},formDescription:{fontSize:"14px",color:"#64748b",marginBottom:"24px",lineHeight:1.5},formField:{marginBottom:"16px"},formLabel:{display:"block",fontSize:"13px",fontWeight:500,color:"#020617",marginBottom:"6px"},formInput:{width:"100%",padding:"10px 12px",border:"1px solid #dcdcdc",borderRadius:"6px",fontSize:"14px",fontFamily:"inherit",color:"#020617",background:"white",transition:"border-color 0.2s ease-out, box-shadow 0.2s ease-out",boxSizing:"border-box"},formInputError:{borderColor:"#ef4444"},formError:{fontSize:"12px",color:"#ef4444",marginTop:"4px"},formSubmitButton:{width:"100%",padding:"12px 16px",borderRadius:"6px",background:e,color:"white",border:"none",cursor:"pointer",fontSize:"14px",fontWeight:600,transition:"all 0.2s ease-out",marginTop:"8px"},formOptional:{fontSize:"12px",color:"#939393",fontWeight:400}}),ye=0;function be(e,t,i,n,o,s){t||(t={});var l,a,u=t;if("ref"in u)for(a in u={},t)"ref"==a?l=t[a]:u[a]=t[a];var d={type:e,props:u,key:i,ref:l,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--ye,__i:-1,__u:0,__source:o,__self:s};if("function"==typeof e&&(l=e.defaultProps))for(a in l)void 0===u[a]&&(u[a]=l[a]);return r.vnode&&r.vnode(d),d}var xe=e=>{var{primaryColor:t,handleToggleOpen:i,unreadCount:n=0}=e,r=we(t),o=n>99?"99+":n.toString();return be("div",{style:r.widget,children:be("div",{style:r.buttonContainer,children:[be("button",{style:r.button,onClick:i,"aria-label":n>0?"Open chat ("+n+" unread)":"Open chat",onMouseEnter:e=>{e.currentTarget.style.transform="scale(1.05)",e.currentTarget.style.boxShadow="0 6px 20px rgba(0, 0, 0, 0.2)"},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)",e.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)"},children:be("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:be("path",{d:"M12 2C6.48 2 2 6.48 2 12C2 13.93 2.6 15.71 3.64 17.18L2.5 21.5L7.04 20.42C8.46 21.28 10.17 21.75 12 21.75C17.52 21.75 22 17.27 22 11.75C22 6.23 17.52 2 12 2Z",fill:"currentColor"})})}),n>0&&be("div",{style:r.unreadBadge,children:o})]})})},_e=e=>{var{primaryColor:t,inputValue:n,isLoading:r,handleSendMessage:o}=e;return be("button",{style:i({},we(t).sendButton,{opacity:!n.trim()||r?.6:1,cursor:!n.trim()||r?"not-allowed":"pointer"}),onClick:o,disabled:!n.trim()||r,"aria-label":"Send message",onMouseEnter:e=>{e.currentTarget.disabled||(e.currentTarget.style.transform="scale(1.02)",e.currentTarget.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.1)")},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)",e.currentTarget.style.boxShadow="0 2px 0 rgba(0, 0, 0, 0.045)"},children:be("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:be("path",{d:"M2 10L18 2L10 18L8 11L2 10Z",fill:"currentColor",stroke:"currentColor",strokeWidth:"2",strokeLinejoin:"round"})})})},ke=e=>{var{primaryColor:t,handleClose:i}=e;return be("button",{style:we(t).headerButton,onClick:i,"aria-label":"Close",onMouseEnter:e=>{e.currentTarget.style.background="rgba(255, 255, 255, 0.15)",e.currentTarget.style.opacity="1"},onMouseLeave:e=>{e.currentTarget.style.background="transparent",e.currentTarget.style.opacity="0.9"},children:"âœ•"})},Ie=ne("[ConversationsWidget]");class Ce extends _{constructor(e){var i;super(e),i=this,this.S=null,this.T=null,this.M=()=>{this.setState((e=>({state:"open"===e.state?"closed":"open"})))},this.F=()=>{this.setState({state:"closed"})},this.D=e=>{var t=e.target;this.setState({inputValue:t.value})},this.P=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),this.A())},this.L=e=>{var t=e.target;this.setState({formName:t.value})},this.W=e=>{var t=e.target;this.setState({formEmail:t.value,formEmailError:null})},this.N=e=>{e.preventDefault();var{formEmail:t,formName:i}=this.state,{config:n,onIdentify:r}=this.props;if(!n.requireEmail||t.trim())if(!t.trim()||this.U(t.trim())){var o={};i.trim()&&(o.name=i.trim()),t.trim()&&(o.email=t.trim()),this.setState({userTraits:o,showIdentificationForm:!1}),r&&r(o)}else this.setState({formEmailError:"Please enter a valid email address"});else this.setState({formEmailError:"Email is required"})},this.A=t((function*(){var{inputValue:e}=i.state,t=e.trim();if(t){var n={id:"temp-"+Date.now(),content:t,author_type:"customer",author_name:"You",created_at:(new Date).toISOString(),is_private:!1};i.setState({messages:[...i.state.messages,n],inputValue:"",isLoading:!0,error:null});try{yield i.props.onSendMessage(t),i.setState({isLoading:!1})}catch(e){Ie.error("Failed to send message",e),i.setState({isLoading:!1,error:e instanceof Error?e.message:"Failed to send message"}),i.setState((e=>({messages:e.messages.filter((e=>e.id!==n.id))})))}}}));var n=e.initialUserTraits||null,r=this.R(e.config,n);this.state={state:e.initialState||"closed",messages:[],inputValue:"",isLoading:!1,error:null,showIdentificationForm:r,formName:(null==n?void 0:n.name)||"",formEmail:(null==n?void 0:n.email)||"",formEmailError:null,userTraits:n,unreadCount:0}}R(e,t){return!!e.requireEmail&&(null==t||!t.email)}componentDidMount(){0===this.state.messages.length&&this.props.config.greetingText&&this.B()}componentDidUpdate(e,t){this.state.messages.length!==t.messages.length&&this.$(),this.state.state!==t.state&&this.props.onStateChange&&this.props.onStateChange(this.state.state),"open"===this.state.state&&"open"!==t.state&&(this.O(),this.$())}B(){var e={id:"greeting",content:this.props.config.greetingText||"Hi! How can we help?",author_type:"AI",author_name:"Support",created_at:(new Date).toISOString(),is_private:!1};this.setState({messages:[e]})}$(){this.S&&this.S.scrollIntoView({behavior:"smooth"})}O(){this.T&&this.T.focus()}U(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}H(e){var t=new Date(e),i=(new Date).getTime()-t.getTime(),n=Math.floor(i/6e4);return n<1?"Just now":n<60?n+"m ago":n<1440?Math.floor(n/60)+"h ago":t.toLocaleDateString()}addMessages(e){this.setState((t=>{var i=new Set(t.messages.map((e=>e.id))),n=e.filter((e=>!i.has(e.id)));return n.length>0?{messages:[...t.messages,...n]}:null}))}show(){this.setState({state:"open"})}hide(){this.setState({state:"closed"})}close(){this.setState({state:"closed"})}getUserTraits(){return this.state.userTraits}setUnreadCount(e){this.setState({unreadCount:e})}j(e){var{config:t}=this.props,{formName:n,formEmail:r,formEmailError:o}=this.state,s=t.identificationFormTitle||"Before we start...",l=t.identificationFormDescription||"Please provide your details so we can help you better.",a=!1!==t.collectName;return be("div",{style:e.identificationForm,children:[be("div",{style:e.formTitle,children:s}),be("div",{style:e.formDescription,children:l}),be("form",{onSubmit:this.N,children:[a&&be("div",{style:e.formField,children:[be("label",{style:e.formLabel,children:["Name ",be("span",{style:e.formOptional,children:"(optional)"})]}),be("input",{type:"text",style:e.formInput,value:n,onInput:this.L,placeholder:"Your name",autoComplete:"name"})]}),be("div",{style:e.formField,children:[be("label",{style:e.formLabel,children:["Email ",!t.requireEmail&&be("span",{style:e.formOptional,children:"(optional)"})]}),be("input",{type:"email",style:i({},e.formInput,o?e.formInputError:{}),value:r,onInput:this.W,placeholder:"you@example.com",autoComplete:"email"}),o&&be("div",{style:e.formError,children:o})]}),be("button",{type:"submit",style:e.formSubmitButton,onMouseEnter:e=>{e.currentTarget.style.opacity="0.9"},onMouseLeave:e=>{e.currentTarget.style.opacity="1"},children:"Start Chat"})]})]})}V(e,t){var n="customer"===e.author_type,r=i({},t.message,n?t.messageCustomer:t.messageAgent),o=i({},t.messageContent,n?t.messageContentCustomer:t.messageContentAgent);return be("div",{style:r,children:[!n&&e.author_name&&be("div",{style:t.messageAuthor,children:e.author_name}),be("div",{style:o,children:e.content}),be("div",{style:t.messageTime,children:this.H(e.created_at)})]},e.id)}render(){var{config:e}=this.props,{state:t,messages:n,inputValue:r,isLoading:o,error:s,showIdentificationForm:l}=this.state,a=e.color||"#5375ff",u=e.placeholderText||"Type your message...",d=we(a);if("closed"===t)return be(xe,{primaryColor:a,handleToggleOpen:this.M,unreadCount:this.state.unreadCount});var h=i({},d.window,d.windowOpen);return be("div",{style:d.widget,children:be("div",{style:h,children:[be("div",{style:d.header,children:[be("div",{style:d.headerTitle,children:be("span",{children:"Support Chat"})}),be("div",{style:d.headerActions,children:be(ke,{primaryColor:a,handleClose:this.F})})]}),l?this.j(d):be(x,{children:[be("div",{style:d.messages,children:[n.map((e=>this.V(e,d))),be("div",{ref:e=>{this.S=e}})]}),s&&be("div",{style:d.error,children:s}),be("div",{style:d.inputContainer,children:[be("textarea",{ref:e=>{this.T=e},style:d.input,placeholder:u,value:r,onInput:this.D,onKeyPress:this.P,rows:1,disabled:o}),be(_e,{primaryColor:a,inputValue:r,isLoading:o,handleSendMessage:this.A})]})]})]})})}}var Se={};function Ee(e,t,i){if(!(e=>G(e)||(e=>null===e)(e))(e)){if(q(e))return function(e,t,i){if(q(e))if(J&&e.forEach===J)e.forEach(t,i);else if("length"in e&&e.length===+e.length)for(var n=0,r=e.length;n<r;n++)if(n in e&&t.call(i,e[n],n)===Se)return}(e,t,i);if((e=>e instanceof FormData)(e)){for(var n of e.entries())if(t.call(i,n[1],n[0])===Se)return}else for(var r in e)if(V.call(e,r)&&t.call(i,e[r],r)===Se)return}}var Te=function(e,t){var i,n;void 0===t&&(t="&");var r=[];return Ee(e,(function(e,t){G(e)||G(t)||"undefined"===t||(i=encodeURIComponent((e=>e instanceof File)(e)?e.name:e.toString()),n=encodeURIComponent(t),r[r.length]=n+"="+i)})),r.join(t)},Me=ne("[ConversationsManager]"),Fe="ph-conversations-widget-container";class De{constructor(e,i){var n=this;this.Y=null,this.q=null,this.G=null,this.X=null,this.K=null,this.Z=!1,this.J=null,this.ee=0,this.te=!1,this.ie=e=>{this.ne.saveUserTraits(e),this._posthog.capture("$conversations_user_identified",{hasName:!!e.name,hasEmail:!!e.email})},this.A=function(){var e=t((function*(e){var t,i=(null==(t=n.Y)?void 0:t.getUserTraits())||void 0;try{yield n.sendMessage(e,i),setTimeout((()=>n.re()),1e3)}catch(e){throw Me.error("Failed to send message",e),e}}));return function(t){return e.apply(this,arguments)}}(),this.oe=e=>{Me.info("Widget state changed",{state:e}),this._posthog.capture("$conversations_widget_state_changed",{state:e,ticketId:this.G}),this.ne.saveWidgetState(e),"open"===e&&this.ee>0&&this.G&&this.se()},this.re=t((function*(){if(!n.Z&&n.G){n.Z=!0;try{yield n.le()}finally{n.Z=!1}}})),this._posthog=i,this.ae=e,this.ne=new me(i),this.ue=this.ne.getOrCreateWidgetSessionId(),this.de=!0===e.widgetEnabled,this.he=function(e){var t;if(!e||0===e.length)return!0;var i=null==K||null==(t=K.location)?void 0:t.hostname;return!i||e.some((e=>{var t=function(e){var t=e.replace(/^https?:\/\//,"");return(t=t.split("/")[0].split("?")[0].split(":")[0])||null}(e);if(!t)return!1;if(t.startsWith("*.")){var n=t.slice(2);return i.endsWith("."+n)||i===n}return i===t}))}(e.domains),Me.info("ConversationsManager initialized",{config:e,widgetSessionId:this.ue,isWidgetEnabled:this.de,isDomainAllowed:this.he}),this.ce()}sendMessage(e,i,n){var r=this;return t((function*(){var t=n?null:r.G,o=!t,s=r.ae.token;return new Promise(((l,a)=>{var u,d=r._posthog.get_distinct_id(),h=(null==(u=r._posthog.persistence)?void 0:u.props)||{},c=(null==i?void 0:i.name)||h.$name||h.name||null,f=(null==i?void 0:i.email)||h.$email||h.email||null,v={widget_session_id:r.ue,distinct_id:d,message:e.trim(),traits:{name:c,email:f},ticket_id:t};try{var p,g=r._posthog.get_session_id();g&&(v.session_id=g);var m=r._posthog.get_session_replay_url({withTimestamp:!0,timestampLookBack:30}),w=o?null==K||null==(p=K.location)?void 0:p.href:void 0;(m||w)&&(v.session_context={session_replay_url:m||void 0,current_url:w||void 0})}catch(e){Me.warn("Failed to capture session context",e)}r._posthog._send_request({url:r._posthog.requestRouter.endpointFor("api","/api/conversations/v1/widget/message"),method:"POST",data:v,headers:{"X-Conversations-Token":s},callback:t=>{if(429!==t.statusCode){if(200!==t.statusCode&&201!==t.statusCode){var i,s,u=(null==(i=t.json)?void 0:i.detail)||(null==(s=t.json)?void 0:s.message)||"Failed to send message";return Me.error("Failed to send message",{status:t.statusCode}),void a(new Error(u))}if(t.json){var d=t.json;o&&d.ticket_id&&(r.G=d.ticket_id,r.ne.saveTicketId(d.ticket_id),Me.info("New ticket created",{ticketId:d.ticket_id,forced:!0===n})),r._posthog.capture("$conversations_message_sent",{ticketId:d.ticket_id,isNewTicket:o,messageLength:e.length}),r.K=d.created_at,l(d)}else a(new Error("Invalid response from server"))}else a(new Error("Too many requests. Please wait before trying again."))}})}))}))()}fe(e){e&&e!==this.G&&(this.G=e,this.ne.saveTicketId(e),this.K=null)}getMessages(e,i){var n=this;return t((function*(){var t=e||n.G;if(!t)throw new Error("No ticket ID provided and no active conversation");n.fe(e);var r=n.ae.token;return new Promise(((e,o)=>{var s={widget_session_id:n.ue,limit:"50"};i&&(s.after=i),n._posthog._send_request({url:n._posthog.requestRouter.endpointFor("api","/api/conversations/v1/widget/messages/"+t+"?"+Te(s)),method:"GET",headers:{"X-Conversations-Token":r},callback:t=>{if(429!==t.statusCode){if(200!==t.statusCode){var i,n,r=(null==(i=t.json)?void 0:i.detail)||(null==(n=t.json)?void 0:n.message)||"Failed to fetch messages";return Me.error("Failed to fetch messages",{status:t.statusCode}),void o(new Error(r))}if(t.json){var s=t.json;e(s)}else o(new Error("Invalid response from server"))}else o(new Error("Too many requests. Please wait before trying again."))}})}))}))()}markAsRead(e){var i=this;return t((function*(){var t=e||i.G;if(!t)throw new Error("No ticket ID provided and no active conversation");i.fe(e);var n=i.ae.token;return Me.info("Marking messages as read",{ticketId:t}),new Promise(((e,r)=>{i._posthog._send_request({url:i._posthog.requestRouter.endpointFor("api","/api/conversations/v1/widget/messages/"+t+"/read"),method:"POST",data:{widget_session_id:i.ue},headers:{"X-Conversations-Token":n},callback:t=>{if(429!==t.statusCode){if(200!==t.statusCode){var i,n,o=(null==(i=t.json)?void 0:i.detail)||(null==(n=t.json)?void 0:n.message)||"Failed to mark messages as read";return Me.error("Failed to mark messages as read",{status:t.statusCode}),void r(new Error(o))}if(t.json){var s=t.json;e(s)}else r(new Error("Invalid response from server"))}else r(new Error("Too many requests. Please wait before trying again."))}})}))}))()}ce(){ee&&K?(this.G=this.ne.loadTicketId(),Me.info("Loaded ticket ID from storage",{ticketId:this.G}),this._posthog.capture("$conversations_loaded",{hasExistingTicket:!!this.G,widgetEnabled:this.de,domainAllowed:this.he}),this.de&&this.he?this.ve():Me.info("Widget not rendered",{widgetEnabled:this.de,domainAllowed:this.he}),this.pe()):Me.info("Conversations not available: Document or window not available")}ve(){if(!this.te){var e="closed";"open"===this.ne.loadWidgetState()&&(e="open");var t=this.ge();this.me(e,t),this.te=!0,this._posthog.capture("$conversations_widget_loaded",{hasExistingTicket:!!this.G,initialState:e,hasUserTraits:!!t}),this.G&&this.le(),this.we()}}ge(){var e,t=(null==(e=this._posthog.persistence)?void 0:e.props)||{},i=t.$name||t.name,n=t.$email||t.email;if(i||n)return{name:i||void 0,email:n||void 0};var r=this.ne.loadUserTraits();return r&&(r.name||r.email)?r:null}se(){var e=this;return t((function*(){if(e.G)try{var t,i=yield e.markAsRead(e.G||void 0);e.ee=i.unread_count,null==(t=e.Y)||t.setUnreadCount(0),Me.info("Messages marked as read",{unreadCount:i.unread_count})}catch(e){Me.error("Failed to mark messages as read",e)}}))()}le(){var e=this;return t((function*(){if(e.G)try{var t,i=yield e.getMessages(e.G||void 0,e.K||void 0);if(X(i.unread_count))e.ee=i.unread_count,null==(t=e.Y)||t.setUnreadCount(i.unread_count),i.unread_count>0&&e.ye()&&e.se();if(i.messages.length>0){var n;null==(n=e.Y)||n.addMessages(i.messages);var r=i.messages[i.messages.length-1];e.K=r.created_at}}catch(e){Me.error("Failed to load messages",e)}}))()}ye(){return"open"===this.ne.loadWidgetState()}we(){this.X||(this.re(),this.X=null==K?void 0:K.setInterval((()=>{this.re()}),5e3),Me.info("Started polling for messages"))}be(){this.X&&(null==K||K.clearInterval(this.X),this.X=null,Me.info("Stopped polling for messages"))}pe(){this.J=this._posthog.on("eventCaptured",(e=>{if("$identify"===e.event){var t,i,n=null==(t=e.properties)?void 0:t.distinct_id,r=null==(i=e.properties)?void 0:i.$anon_distinct_id;r&&n&&r!==n&&(Me.info("Detected identify event",{oldDistinctId:r,newDistinctId:n}),this.xe(r,n))}}))}xe(e,t){Me.info("User identified, conversation continues with same widget_session_id",{ticketId:this.G,widgetSessionId:this.ue,oldDistinctId:e,newDistinctId:t}),this._posthog.capture("$conversations_identity_changed",{hadExistingTicket:!!this.G})}show(){this.he?this.te||this.ve():Me.warn("Cannot show widget: current domain is not allowed")}hide(){this.be(),this.q&&(O(null,this.q),this.q.remove(),this.q=null),this.Y=null,this.te=!1,this.K=null}isVisible(){return this.te}getTickets(e){var i=this;return t((function*(){var t,n,r=i.ae.token,o={widget_session_id:i.ue,limit:String(null!==(t=null==e?void 0:e.limit)&&void 0!==t?t:20),offset:String(null!==(n=null==e?void 0:e.offset)&&void 0!==n?n:0)};return null!=e&&e.status&&(o.status=e.status),new Promise(((e,t)=>{i._posthog._send_request({url:i._posthog.requestRouter.endpointFor("api","/api/conversations/v1/widget/tickets?"+Te(o)),method:"GET",headers:{"X-Conversations-Token":r},callback:i=>{if(429!==i.statusCode){if(200!==i.statusCode){var n,r,o=(null==(n=i.json)?void 0:n.detail)||(null==(r=i.json)?void 0:r.message)||"Failed to fetch tickets";return Me.error("Failed to fetch tickets",{status:i.statusCode}),void t(new Error(o))}if(i.json){var s=i.json;e(s)}else t(new Error("Invalid response from server"))}else t(new Error("Too many requests. Please wait before trying again."))}})}))}))()}getCurrentTicketId(){return this.G}getWidgetSessionId(){return this.ue}destroy(){this.be(),this.J&&(this.J(),this.J=null),this.q&&(O(null,this.q),this.q.remove(),this.q=null),this.Y=null,Me.info("Widget destroyed")}reset(){this.ne.clearAll(),this.G=null,this.K=null,this.ee=0,this.destroy(),Me.info("Conversations reset")}me(e,t){if(ee){var i=ee.getElementById(Fe);if(!i){if(!ee.body)return void Me.info("Conversations widget not rendered: Document body not available yet");(i=ee.createElement("div")).id=Fe,ee.body.appendChild(i)}this.q=i,O(be(Ce,{ref:e=>{this.Y=e},config:this.ae,initialState:e,initialUserTraits:t,onSendMessage:this.A,onStateChange:this.oe,onIdentify:this.ie}),i)}else Me.info("Conversations widget not rendered: Document not available")}}function Pe(e,t){return Me.info("initConversations called",{hasConfig:!!e,hasPosthog:!!t}),new De(e,t)}te.__PosthogExtensions__=te.__PosthogExtensions__||{},te.__PosthogExtensions__.initConversations=Pe}();
//# sourceMappingURL=conversations.js.map
